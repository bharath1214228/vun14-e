/*! springshare 1.11.0 */

!function(t){var e=function(t){if(void 0===t&&(t={}),this.setConfig=function(t){this.id=t.id?t.id:"s-sui-modal",this.title=t.title?t.title:"",this.content=t.content?t.content:"",this.url=t.url?t.url:null,this.fade=!!t.fade,this.callback=t.callback?t.callback:null,this.closeCallback=t.closeCallback?t.closeCallback:null,this.footer=!0===t.footer&&t.footer,this.size=t.size?t.size:"",this.modal_buttons=t.buttons?t.buttons:[],this.returnfocus=!1!==t.returnfocus,this.opener=document.activeElement,this.btn_callbacks={},this.backdrop=void 0===t.backdrop||("static"===t.backdrop?"static":!!t.backdrop),this.keyboard=!1!==t.keyboard},this.setConfig(t),this.$el=jQuery("#"+this.id),0===jQuery("#"+this.id).length)if(this.$el=jQuery('<div class="modal '+(this.fade?"fade":"")+'" tabindex="-1" role="dialog" aria-labelledby="s-sui-modal-header"></div>').attr("id",this.id).html('<div class="modal-dialog"><div class="modal-content"></div></div>'),"s-sui-modal"===this.id)jQuery("body").prepend(this.$el);else{var e=jQuery("div.modal");e.length>0?e.filter(":last").after(this.$el):jQuery("body").prepend(this.$el)}"large"===this.size&&this.$el.find(".modal-dialog").addClass("modal-lg"),this.retrieveSuccess=function(t){t.title&&(this.title=t.title),t.content&&(this.content=t.content),t.buttons&&(this.modal_buttons=t.buttons),this.footer=!(!t.footer||!0!==t.footer),this.draw()},this.retrieveFail=function(t){var e="Unknown";if(t.responseText)try{var s=JSON.parse(t.responseText);s.error&&(e=s.error)}catch(t){e="Invalid response received"}this.content="Error: "+e,this.modal_buttons=[{label:"Close",callback:"e.data.modal.close();"}],this.draw()},this.retrieve=function(){jQuery.ajax({url:this.url,cache:!1,method:"GET",dataType:"json"}).done(this.retrieveSuccess.bind(this)).fail(this.retrieveFail.bind(this))},this.handleShowEvent=function(){null!==this.callback&&this.callback(this)},this.handleHideEvent=function(){this.returnfocus&&void 0!==this.opener&&null!==this.opener&&this.opener.focus(),null!==this.closeCallback&&this.closeCallback(this),this.$el.off().removeData("bs.modal").find(".modal-content").html(""),jQuery("#"+this.id+" .modal-dialog").removeClass("modal-lg"),this.callback=null,this.closeCallback=null},this.draw=function(){var t='<div class="modal-content">';""!==this.title&&(t+='<div class="modal-header"><button id="s-sui-modal-close" type="button" class="close" data-dismiss="modal" aria-label="Close">&times;</button><h4 class="modal-title" id="s-sui-modal-header">'+this.title+"</h4></div>");var e="";"string"==typeof this.content&&(e=this.content),t+='<div class="modal-body">'+e+"</div>",(this.footer||this.modal_buttons.length>0)&&(this.btn_callbacks={},t+='<div class="modal-footer">',0===this.modal_buttons.length?t+='<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>':this.modal_buttons.forEach(function(e,s){e.links&&e.links.length>0?(e.gclass=e.gclass?e.gclass:"",t+='<div class="btn-group '+e.gclass+'">',e.bclass=e.bclass?e.bclass:"btn-default",e.label=e.label?e.label:"",""!==e.label&&(t+='<button type="button" class="btn '+e.bclass+" btn-modal-"+s+'" >'+e.label+"</button>",e.callback&&(this.btn_callbacks["btn-modal-"+s]=e.callback)),t+='<button type="button" class="btn '+e.bclass+' dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span><span class="sr-only">Toggle Dropdown</span></button>',t+='<ul class="dropdown-menu">',e.links.forEach(function(e,s){if(e.label=e.label?e.label:"",""!==e.label){var i=e.url?e.url:"#";t+='<li><a href="'+i+'" class="link-modal-'+s+'">'+e.label+"</a></li>",e.callback&&(this.btn_callbacks["link-modal-"+s]=e.callback)}},this),t+="</ul>",t+="</div>"):(e.bclass=e.bclass?e.bclass:"btn-default",e.label=e.label?e.label:"",""!==e.label&&(t+='<button type="button" class="btn '+e.bclass+" btn-modal-"+s+'" >'+e.label+"</button>",e.callback&&(this.btn_callbacks["btn-modal-"+s]=e.callback)))},this),t+="</div>"),t+="</div>";var s=jQuery(t);if("string"!=typeof this.content&&s.find(".modal-body").html(this.content),this.$el.find(".modal-content").replaceWith(s),this.modal_buttons.length>0)for(var i in this.btn_callbacks)if(this.btn_callbacks.hasOwnProperty(i)){if("string"==typeof this.btn_callbacks[i]){var r=new Function("e",this.btn_callbacks[i]);this.btn_callbacks[i]=r}"function"==typeof this.btn_callbacks[i]&&this.$el.find("."+i).on("click",{modal:this},this.btn_callbacks[i])}this.$el.on("show.bs.modal",this.handleShowEvent.bind(this)),this.$el.modal({backdrop:this.backdrop,keyboard:this.keyboard},"show"),this.$el.on("hidden.bs.modal",this.handleHideEvent.bind(this))},this.close=function(){jQuery("#"+this.id).modal("hide")},this.redraw=function(t){this.$el.unbind("show.bs.modal").unbind("hidden.bs.modal"),this.setConfig(t),null!==this.url?this.retrieve():this.draw()},null!==this.url?this.retrieve():this.draw()};"undefined"!=typeof module?module.exports=e:(t.springSpace=t.springSpace||{},t.springSpace.sui=t.springSpace.sui||{},t.springSpace.sui.modal=t.springSpace.sui.modal||e)}(this);var springSpace=springSpace||{};springSpace.sui=springSpace.sui||{},springSpace.sui.notify_=function(){this.parent_id="s-ui-alertarea",this.html_id="s-ui-notification",this.className="s-ui-notification",this.timeout=null,this.error=function(t){void 0!==t&&""!==t||(t="Error: Please try again.");var e={className:"s-ui-notification-error",duration:5e3,msg:t};this.show(e)},this.success=function(t){void 0!==t&&""!==t||(t="Success.");var e={className:"s-ui-notification-success",duration:5e3,msg:t};this.show(e)},this.working=function(t){void 0!==t&&""!==t||(t=' <i class="fa fa-spinner fa-3x fa-pulse"></i><span class="sr-only">Working...</span> '),settings={msg:t,duration:3e4},this.show(settings)},this.show=function(t){var e=this;if(void 0!==t&&t.msg&&""!==t.msg&&null!==t.msg){t.duration||0===t.duration||(t.duration=5e3);var s=jQuery("#"+this.html_id);if(s.length>0&&s.remove(),s=jQuery("<div></div>").attr({id:this.html_id}),0==(i=jQuery("#"+this.parent_id)).length)var i=jQuery("<div></div>").attr({id:this.parent_id,role:"alert"}).appendTo(jQuery("body"));s.appendTo(i);var r={};t.bgcolor&&(r.backgroundColor=t.bgcolor),t.fgcolor&&(r.color=t.fgcolor),s.addClass(t.className?t.className:this.className).html(t.msg).css(r).on("mouseover",function(){clearTimeout(e.timeout)}).on("mouseout",function(){t.duration>0&&(e.timeout=setTimeout(e.hide.bind(e),t.duration))}).on("click",e.hide.bind(e)).wrapInner('<div class="s-ui-notification-message" />');var a=jQuery(window).width(),n=jQuery(window).height(),o=s.outerWidth(),l=n/2-s.outerHeight()/2,c=a/2-o/2;s.css({top:l,left:c}).fadeIn(200,function(){t.duration>0&&(e.timeout=setTimeout(e.hide.bind(e),t.duration))})}},this.hide=function(){jQuery("#"+this.html_id).off("mouseover mouseout").fadeOut(200,function(){jQuery(this).empty()}),clearTimeout(this.timeout)}},springSpace.sui.notify=new springSpace.sui.notify_;var springSpace=springSpace||{};function errorAlert(t){springSpace.sui.notify.error(t)}function successAlert(t){springSpace.sui.notify.success(t)}function workingAlert(t){springSpace.sui.notify.working()}function longWorkingAlert(){springSpace.sui.notify.working()}function stopAlert(){springSpace.sui.notify.hide()}springSpace.sui=springSpace.sui||{},springSpace.sui.storage_=function(){this.supported=!1,this.get=function(t){var e=null;return this.supported&&(e=localStorage.getItem(t)),null!==e?e:""},this.set=function(t,e){if(this.supported){try{localStorage.setItem(t,e)}catch(t){return!1}return!0}return!0},this.remove=function(t){this.supported&&localStorage.removeItem(t)},this.iterate=function(t){if(this.supported&&localStorage.length>0){for(var e=[],s=0;s<localStorage.length;s++)e.push(localStorage.key(s));if(e.length>0)for(s=0;s<e.length;s++)t.call(this,e[s])}};try{if(!("localStorage"in window&&null!==window.localStorage))return;this.supported=!0}catch(t){return}},springSpace.sui.storage=new springSpace.sui.storage_,function(){var t=this,e=t._,s=Array.prototype,i=Object.prototype,r=Function.prototype,a=s.push,n=s.slice,o=i.toString,l=i.hasOwnProperty,c=Array.isArray,u=Object.keys,h=r.bind,d=Object.create,p=function(){},f=function(t){return t instanceof f?t:this instanceof f?void(this._wrapped=t):new f(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=f),exports._=f):t._=f,f.VERSION="1.8.3";var g=function(t,e,s){if(void 0===e)return t;switch(null==s?3:s){case 1:return function(s){return t.call(e,s)};case 2:return function(s,i){return t.call(e,s,i)};case 3:return function(s,i,r){return t.call(e,s,i,r)};case 4:return function(s,i,r,a){return t.call(e,s,i,r,a)}}return function(){return t.apply(e,arguments)}},m=function(t,e,s){return null==t?f.identity:f.isFunction(t)?g(t,e,s):f.isObject(t)?f.matcher(t):f.property(t)};f.iteratee=function(t,e){return m(t,e,1/0)};var v=function(t,e){return function(s){var i=arguments.length;if(i<2||null==s)return s;for(var r=1;r<i;r++)for(var a=arguments[r],n=t(a),o=n.length,l=0;l<o;l++){var c=n[l];e&&void 0!==s[c]||(s[c]=a[c])}return s}},y=function(t){if(!f.isObject(t))return{};if(d)return d(t);p.prototype=t;var e=new p;return p.prototype=null,e},b=function(t){return function(e){return null==e?void 0:e[t]}},_=Math.pow(2,53)-1,S=b("length"),w=function(t){var e=S(t);return"number"==typeof e&&e>=0&&e<=_};function j(t){return function(e,s,i,r){s=g(s,r,4);var a=!w(e)&&f.keys(e),n=(a||e).length,o=t>0?0:n-1;return arguments.length<3&&(i=e[a?a[o]:o],o+=t),function(e,s,i,r,a,n){for(;a>=0&&a<n;a+=t){var o=r?r[a]:a;i=s(i,e[o],o,e)}return i}(e,s,i,a,o,n)}}f.each=f.forEach=function(t,e,s){var i,r;if(e=g(e,s),w(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var a=f.keys(t);for(i=0,r=a.length;i<r;i++)e(t[a[i]],a[i],t)}return t},f.map=f.collect=function(t,e,s){e=m(e,s);for(var i=!w(t)&&f.keys(t),r=(i||t).length,a=Array(r),n=0;n<r;n++){var o=i?i[n]:n;a[n]=e(t[o],o,t)}return a},f.reduce=f.foldl=f.inject=j(1),f.reduceRight=f.foldr=j(-1),f.find=f.detect=function(t,e,s){var i;if(void 0!==(i=w(t)?f.findIndex(t,e,s):f.findKey(t,e,s))&&-1!==i)return t[i]},f.filter=f.select=function(t,e,s){var i=[];return e=m(e,s),f.each(t,function(t,s,r){e(t,s,r)&&i.push(t)}),i},f.reject=function(t,e,s){return f.filter(t,f.negate(m(e)),s)},f.every=f.all=function(t,e,s){e=m(e,s);for(var i=!w(t)&&f.keys(t),r=(i||t).length,a=0;a<r;a++){var n=i?i[a]:a;if(!e(t[n],n,t))return!1}return!0},f.some=f.any=function(t,e,s){e=m(e,s);for(var i=!w(t)&&f.keys(t),r=(i||t).length,a=0;a<r;a++){var n=i?i[a]:a;if(e(t[n],n,t))return!0}return!1},f.contains=f.includes=f.include=function(t,e,s,i){return w(t)||(t=f.values(t)),("number"!=typeof s||i)&&(s=0),f.indexOf(t,e,s)>=0},f.invoke=function(t,e){var s=n.call(arguments,2),i=f.isFunction(e);return f.map(t,function(t){var r=i?e:t[e];return null==r?r:r.apply(t,s)})},f.pluck=function(t,e){return f.map(t,f.property(e))},f.where=function(t,e){return f.filter(t,f.matcher(e))},f.findWhere=function(t,e){return f.find(t,f.matcher(e))},f.max=function(t,e,s){var i,r,a=-1/0,n=-1/0;if(null==e&&null!=t)for(var o=0,l=(t=w(t)?t:f.values(t)).length;o<l;o++)(i=t[o])>a&&(a=i);else e=m(e,s),f.each(t,function(t,s,i){((r=e(t,s,i))>n||r===-1/0&&a===-1/0)&&(a=t,n=r)});return a},f.min=function(t,e,s){var i,r,a=1/0,n=1/0;if(null==e&&null!=t)for(var o=0,l=(t=w(t)?t:f.values(t)).length;o<l;o++)(i=t[o])<a&&(a=i);else e=m(e,s),f.each(t,function(t,s,i){((r=e(t,s,i))<n||r===1/0&&a===1/0)&&(a=t,n=r)});return a},f.shuffle=function(t){for(var e,s=w(t)?t:f.values(t),i=s.length,r=Array(i),a=0;a<i;a++)(e=f.random(0,a))!==a&&(r[a]=r[e]),r[e]=s[a];return r},f.sample=function(t,e,s){return null==e||s?(w(t)||(t=f.values(t)),t[f.random(t.length-1)]):f.shuffle(t).slice(0,Math.max(0,e))},f.sortBy=function(t,e,s){return e=m(e,s),f.pluck(f.map(t,function(t,s,i){return{value:t,index:s,criteria:e(t,s,i)}}).sort(function(t,e){var s=t.criteria,i=e.criteria;if(s!==i){if(s>i||void 0===s)return 1;if(s<i||void 0===i)return-1}return t.index-e.index}),"value")};var $=function(t){return function(e,s,i){var r={};return s=m(s,i),f.each(e,function(i,a){var n=s(i,a,e);t(r,i,n)}),r}};f.groupBy=$(function(t,e,s){f.has(t,s)?t[s].push(e):t[s]=[e]}),f.indexBy=$(function(t,e,s){t[s]=e}),f.countBy=$(function(t,e,s){f.has(t,s)?t[s]++:t[s]=1}),f.toArray=function(t){return t?f.isArray(t)?n.call(t):w(t)?f.map(t,f.identity):f.values(t):[]},f.size=function(t){return null==t?0:w(t)?t.length:f.keys(t).length},f.partition=function(t,e,s){e=m(e,s);var i=[],r=[];return f.each(t,function(t,s,a){(e(t,s,a)?i:r).push(t)}),[i,r]},f.first=f.head=f.take=function(t,e,s){if(null!=t)return null==e||s?t[0]:f.initial(t,t.length-e)},f.initial=function(t,e,s){return n.call(t,0,Math.max(0,t.length-(null==e||s?1:e)))},f.last=function(t,e,s){if(null!=t)return null==e||s?t[t.length-1]:f.rest(t,Math.max(0,t.length-e))},f.rest=f.tail=f.drop=function(t,e,s){return n.call(t,null==e||s?1:e)},f.compact=function(t){return f.filter(t,f.identity)};var x=function(t,e,s,i){for(var r=[],a=0,n=i||0,o=S(t);n<o;n++){var l=t[n];if(w(l)&&(f.isArray(l)||f.isArguments(l))){e||(l=x(l,e,s));var c=0,u=l.length;for(r.length+=u;c<u;)r[a++]=l[c++]}else s||(r[a++]=l)}return r};function k(t){return function(e,s,i){s=m(s,i);for(var r=S(e),a=t>0?0:r-1;a>=0&&a<r;a+=t)if(s(e[a],a,e))return a;return-1}}function T(t,e,s){return function(i,r,a){var o=0,l=S(i);if("number"==typeof a)t>0?o=a>=0?a:Math.max(a+l,o):l=a>=0?Math.min(a+1,l):a+l+1;else if(s&&a&&l)return i[a=s(i,r)]===r?a:-1;if(r!=r)return(a=e(n.call(i,o,l),f.isNaN))>=0?a+o:-1;for(a=t>0?o:l-1;a>=0&&a<l;a+=t)if(i[a]===r)return a;return-1}}f.flatten=function(t,e){return x(t,e,!1)},f.without=function(t){return f.difference(t,n.call(arguments,1))},f.uniq=f.unique=function(t,e,s,i){f.isBoolean(e)||(i=s,s=e,e=!1),null!=s&&(s=m(s,i));for(var r=[],a=[],n=0,o=S(t);n<o;n++){var l=t[n],c=s?s(l,n,t):l;e?(n&&a===c||r.push(l),a=c):s?f.contains(a,c)||(a.push(c),r.push(l)):f.contains(r,l)||r.push(l)}return r},f.union=function(){return f.uniq(x(arguments,!0,!0))},f.intersection=function(t){for(var e=[],s=arguments.length,i=0,r=S(t);i<r;i++){var a=t[i];if(!f.contains(e,a)){for(var n=1;n<s&&f.contains(arguments[n],a);n++);n===s&&e.push(a)}}return e},f.difference=function(t){var e=x(arguments,!0,!0,1);return f.filter(t,function(t){return!f.contains(e,t)})},f.zip=function(){return f.unzip(arguments)},f.unzip=function(t){for(var e=t&&f.max(t,S).length||0,s=Array(e),i=0;i<e;i++)s[i]=f.pluck(t,i);return s},f.object=function(t,e){for(var s={},i=0,r=S(t);i<r;i++)e?s[t[i]]=e[i]:s[t[i][0]]=t[i][1];return s},f.findIndex=k(1),f.findLastIndex=k(-1),f.sortedIndex=function(t,e,s,i){for(var r=(s=m(s,i,1))(e),a=0,n=S(t);a<n;){var o=Math.floor((a+n)/2);s(t[o])<r?a=o+1:n=o}return a},f.indexOf=T(1,f.findIndex,f.sortedIndex),f.lastIndexOf=T(-1,f.findLastIndex),f.range=function(t,e,s){null==e&&(e=t||0,t=0),s=s||1;for(var i=Math.max(Math.ceil((e-t)/s),0),r=Array(i),a=0;a<i;a++,t+=s)r[a]=t;return r};var q=function(t,e,s,i,r){if(!(i instanceof e))return t.apply(s,r);var a=y(t.prototype),n=t.apply(a,r);return f.isObject(n)?n:a};f.bind=function(t,e){if(h&&t.bind===h)return h.apply(t,n.call(arguments,1));if(!f.isFunction(t))throw new TypeError("Bind must be called on a function");var s=n.call(arguments,2),i=function(){return q(t,i,e,this,s.concat(n.call(arguments)))};return i},f.partial=function(t){var e=n.call(arguments,1),s=function(){for(var i=0,r=e.length,a=Array(r),n=0;n<r;n++)a[n]=e[n]===f?arguments[i++]:e[n];for(;i<arguments.length;)a.push(arguments[i++]);return q(t,s,this,this,a)};return s},f.bindAll=function(t){var e,s,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(e=1;e<i;e++)t[s=arguments[e]]=f.bind(t[s],t);return t},f.memoize=function(t,e){var s=function(i){var r=s.cache,a=""+(e?e.apply(this,arguments):i);return f.has(r,a)||(r[a]=t.apply(this,arguments)),r[a]};return s.cache={},s},f.delay=function(t,e){var s=n.call(arguments,2);return setTimeout(function(){return t.apply(null,s)},e)},f.defer=f.partial(f.delay,f,1),f.throttle=function(t,e,s){var i,r,a,n=null,o=0;s||(s={});var l=function(){o=!1===s.leading?0:f.now(),n=null,a=t.apply(i,r),n||(i=r=null)};return function(){var c=f.now();o||!1!==s.leading||(o=c);var u=e-(c-o);return i=this,r=arguments,u<=0||u>e?(n&&(clearTimeout(n),n=null),o=c,a=t.apply(i,r),n||(i=r=null)):n||!1===s.trailing||(n=setTimeout(l,u)),a}},f.debounce=function(t,e,s){var i,r,a,n,o,l=function(){var c=f.now()-n;c<e&&c>=0?i=setTimeout(l,e-c):(i=null,s||(o=t.apply(a,r),i||(a=r=null)))};return function(){a=this,r=arguments,n=f.now();var c=s&&!i;return i||(i=setTimeout(l,e)),c&&(o=t.apply(a,r),a=r=null),o}},f.wrap=function(t,e){return f.partial(e,t)},f.negate=function(t){return function(){return!t.apply(this,arguments)}},f.compose=function(){var t=arguments,e=t.length-1;return function(){for(var s=e,i=t[e].apply(this,arguments);s--;)i=t[s].call(this,i);return i}},f.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},f.before=function(t,e){var s;return function(){return--t>0&&(s=e.apply(this,arguments)),t<=1&&(e=null),s}},f.once=f.partial(f.before,2);var C=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function A(t,e){var s=I.length,r=t.constructor,a=f.isFunction(r)&&r.prototype||i,n="constructor";for(f.has(t,n)&&!f.contains(e,n)&&e.push(n);s--;)(n=I[s])in t&&t[n]!==a[n]&&!f.contains(e,n)&&e.push(n)}f.keys=function(t){if(!f.isObject(t))return[];if(u)return u(t);var e=[];for(var s in t)f.has(t,s)&&e.push(s);return C&&A(t,e),e},f.allKeys=function(t){if(!f.isObject(t))return[];var e=[];for(var s in t)e.push(s);return C&&A(t,e),e},f.values=function(t){for(var e=f.keys(t),s=e.length,i=Array(s),r=0;r<s;r++)i[r]=t[e[r]];return i},f.mapObject=function(t,e,s){e=m(e,s);for(var i,r=f.keys(t),a=r.length,n={},o=0;o<a;o++)n[i=r[o]]=e(t[i],i,t);return n},f.pairs=function(t){for(var e=f.keys(t),s=e.length,i=Array(s),r=0;r<s;r++)i[r]=[e[r],t[e[r]]];return i},f.invert=function(t){for(var e={},s=f.keys(t),i=0,r=s.length;i<r;i++)e[t[s[i]]]=s[i];return e},f.functions=f.methods=function(t){var e=[];for(var s in t)f.isFunction(t[s])&&e.push(s);return e.sort()},f.extend=v(f.allKeys),f.extendOwn=f.assign=v(f.keys),f.findKey=function(t,e,s){e=m(e,s);for(var i,r=f.keys(t),a=0,n=r.length;a<n;a++)if(e(t[i=r[a]],i,t))return i},f.pick=function(t,e,s){var i,r,a={},n=t;if(null==n)return a;f.isFunction(e)?(r=f.allKeys(n),i=g(e,s)):(r=x(arguments,!1,!1,1),i=function(t,e,s){return e in s},n=Object(n));for(var o=0,l=r.length;o<l;o++){var c=r[o],u=n[c];i(u,c,n)&&(a[c]=u)}return a},f.omit=function(t,e,s){if(f.isFunction(e))e=f.negate(e);else{var i=f.map(x(arguments,!1,!1,1),String);e=function(t,e){return!f.contains(i,e)}}return f.pick(t,e,s)},f.defaults=v(f.allKeys,!0),f.create=function(t,e){var s=y(t);return e&&f.extendOwn(s,e),s},f.clone=function(t){return f.isObject(t)?f.isArray(t)?t.slice():f.extend({},t):t},f.tap=function(t,e){return e(t),t},f.isMatch=function(t,e){var s=f.keys(e),i=s.length;if(null==t)return!i;for(var r=Object(t),a=0;a<i;a++){var n=s[a];if(e[n]!==r[n]||!(n in r))return!1}return!0};var H=function(t,e,s,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof f&&(t=t._wrapped),e instanceof f&&(e=e._wrapped);var r=o.call(t);if(r!==o.call(e))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e}var a="[object Array]"===r;if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var n=t.constructor,l=e.constructor;if(n!==l&&!(f.isFunction(n)&&n instanceof n&&f.isFunction(l)&&l instanceof l)&&"constructor"in t&&"constructor"in e)return!1}s=s||[],i=i||[];for(var c=s.length;c--;)if(s[c]===t)return i[c]===e;if(s.push(t),i.push(e),a){if((c=t.length)!==e.length)return!1;for(;c--;)if(!H(t[c],e[c],s,i))return!1}else{var u,h=f.keys(t);if(c=h.length,f.keys(e).length!==c)return!1;for(;c--;)if(u=h[c],!f.has(e,u)||!H(t[u],e[u],s,i))return!1}return s.pop(),i.pop(),!0};f.isEqual=function(t,e){return H(t,e)},f.isEmpty=function(t){return null==t||(w(t)&&(f.isArray(t)||f.isString(t)||f.isArguments(t))?0===t.length:0===f.keys(t).length)},f.isElement=function(t){return!(!t||1!==t.nodeType)},f.isArray=c||function(t){return"[object Array]"===o.call(t)},f.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},f.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){f["is"+t]=function(e){return o.call(e)==="[object "+t+"]"}}),f.isArguments(arguments)||(f.isArguments=function(t){return f.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(f.isFunction=function(t){return"function"==typeof t||!1}),f.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},f.isNaN=function(t){return f.isNumber(t)&&t!==+t},f.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===o.call(t)},f.isNull=function(t){return null===t},f.isUndefined=function(t){return void 0===t},f.has=function(t,e){return null!=t&&l.call(t,e)},f.noConflict=function(){return t._=e,this},f.identity=function(t){return t},f.constant=function(t){return function(){return t}},f.noop=function(){},f.property=b,f.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},f.matcher=f.matches=function(t){return t=f.extendOwn({},t),function(e){return f.isMatch(e,t)}},f.times=function(t,e,s){var i=Array(Math.max(0,t));e=g(e,s,1);for(var r=0;r<t;r++)i[r]=e(r);return i},f.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},f.now=Date.now||function(){return(new Date).getTime()};var F={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Q=f.invert(F),O=function(t){var e=function(e){return t[e]},s="(?:"+f.keys(t).join("|")+")",i=RegExp(s),r=RegExp(s,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(r,e):t}};f.escape=O(F),f.unescape=O(Q),f.result=function(t,e,s){var i=null==t?void 0:t[e];return void 0===i&&(i=s),f.isFunction(i)?i.call(t):i};var L=0;f.uniqueId=function(t){var e=++L+"";return t?t+e:e},f.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var E=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\u2028|\u2029/g,B=function(t){return"\\"+D[t]};f.template=function(t,e,s){!e&&s&&(e=s),e=f.defaults({},e,f.templateSettings);var i=RegExp([(e.escape||E).source,(e.interpolate||E).source,(e.evaluate||E).source].join("|")+"|$","g"),r=0,a="__p+='";t.replace(i,function(e,s,i,n,o){return a+=t.slice(r,o).replace(M,B),r=o+e.length,s?a+="'+\n((__t=("+s+"))==null?'':_.escape(__t))+\n'":i?a+="'+\n((__t=("+i+"))==null?'':__t)+\n'":n&&(a+="';\n"+n+"\n__p+='"),e}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var n=new Function(e.variable||"obj","_",a)}catch(t){throw t.source=a,t}var o=function(t){return n.call(this,t,f)},l=e.variable||"obj";return o.source="function("+l+"){\n"+a+"}",o},f.chain=function(t){var e=f(t);return e._chain=!0,e};var U=function(t,e){return t._chain?f(e).chain():e};f.mixin=function(t){f.each(f.functions(t),function(e){var s=f[e]=t[e];f.prototype[e]=function(){var t=[this._wrapped];return a.apply(t,arguments),U(this,s.apply(f,t))}})},f.mixin(f),f.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];f.prototype[t]=function(){var s=this._wrapped;return e.apply(s,arguments),"shift"!==t&&"splice"!==t||0!==s.length||delete s[0],U(this,s)}}),f.each(["concat","join","slice"],function(t){var e=s[t];f.prototype[t]=function(){return U(this,e.apply(this._wrapped,arguments))}}),f.prototype.value=function(){return this._wrapped},f.prototype.valueOf=f.prototype.toJSON=f.prototype.value,f.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return f})}.call(this),function(t){var e="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(s,i,r){e.Backbone=t(e,r,s,i)});else if("undefined"!=typeof exports){var s,i=require("underscore");try{s=require("jquery")}catch(t){}t(e,exports,i,s)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(function(t,e,s,i){var r=t.Backbone,a=Array.prototype.slice;e.VERSION="1.2.3",e.$=i,e.noConflict=function(){return t.Backbone=r,this},e.emulateHTTP=!1,e.emulateJSON=!1;var n=function(t,e,i){s.each(e,function(e,r){s[r]&&(t.prototype[r]=function(t,e,i){switch(t){case 1:return function(){return s[e](this[i])};case 2:return function(t){return s[e](this[i],t)};case 3:return function(t,r){return s[e](this[i],o(t,this),r)};case 4:return function(t,r,a){return s[e](this[i],o(t,this),r,a)};default:return function(){var t=a.call(arguments);return t.unshift(this[i]),s[e].apply(s,t)}}}(e,r,i))})},o=function(t,e){return s.isFunction(t)?t:s.isObject(t)&&!e._isModel(t)?l(t):s.isString(t)?function(e){return e.get(t)}:t},l=function(t){var e=s.matches(t);return function(t){return e(t.attributes)}},c=e.Events={},u=/\s+/,h=function(t,e,i,r,a){var n,o=0;if(i&&"object"==typeof i){void 0!==r&&"context"in a&&void 0===a.context&&(a.context=r);for(n=s.keys(i);o<n.length;o++)e=h(t,e,n[o],i[n[o]],a)}else if(i&&u.test(i))for(n=i.split(u);o<n.length;o++)e=t(e,n[o],r,a);else e=t(e,i,r,a);return e};c.on=function(t,e,s){return d(this,t,e,s)};var d=function(t,e,s,i,r){(t._events=h(p,t._events||{},e,s,{context:i,ctx:t,listening:r}),r)&&((t._listeners||(t._listeners={}))[r.id]=r);return t};c.listenTo=function(t,e,i){if(!t)return this;var r=t._listenId||(t._listenId=s.uniqueId("l")),a=this._listeningTo||(this._listeningTo={}),n=a[r];if(!n){var o=this._listenId||(this._listenId=s.uniqueId("l"));n=a[r]={obj:t,objId:r,id:o,listeningTo:a,count:0}}return d(t,e,i,this,n),this};var p=function(t,e,s,i){if(s){var r=t[e]||(t[e]=[]),a=i.context,n=i.ctx,o=i.listening;o&&o.count++,r.push({callback:s,context:a,ctx:a||n,listening:o})}return t};c.off=function(t,e,s){return this._events?(this._events=h(f,this._events,t,e,{context:s,listeners:this._listeners}),this):this},c.stopListening=function(t,e,i){var r=this._listeningTo;if(!r)return this;for(var a=t?[t._listenId]:s.keys(r),n=0;n<a.length;n++){var o=r[a[n]];if(!o)break;o.obj.off(e,i,this)}return s.isEmpty(r)&&(this._listeningTo=void 0),this};var f=function(t,e,i,r){if(t){var a,n=0,o=r.context,l=r.listeners;if(e||i||o){for(var c=e?[e]:s.keys(t);n<c.length;n++){var u=t[e=c[n]];if(!u)break;for(var h=[],d=0;d<u.length;d++){var p=u[d];i&&i!==p.callback&&i!==p.callback._callback||o&&o!==p.context?h.push(p):(a=p.listening)&&0==--a.count&&(delete l[a.id],delete a.listeningTo[a.objId])}h.length?t[e]=h:delete t[e]}return s.size(t)?t:void 0}for(var f=s.keys(l);n<f.length;n++)delete l[(a=l[f[n]]).id],delete a.listeningTo[a.objId]}};c.once=function(t,e,i){var r=h(g,{},t,e,s.bind(this.off,this));return this.on(r,void 0,i)},c.listenToOnce=function(t,e,i){var r=h(g,{},e,i,s.bind(this.stopListening,this,t));return this.listenTo(t,r)};var g=function(t,e,i,r){if(i){var a=t[e]=s.once(function(){r(e,a),i.apply(this,arguments)});a._callback=i}return t};c.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),s=Array(e),i=0;i<e;i++)s[i]=arguments[i+1];return h(m,this._events,t,void 0,s),this};var m=function(t,e,s,i){if(t){var r=t[e],a=t.all;r&&a&&(a=a.slice()),r&&v(r,i),a&&v(a,[e].concat(i))}return t},v=function(t,e){var s,i=-1,r=t.length,a=e[0],n=e[1],o=e[2];switch(e.length){case 0:for(;++i<r;)(s=t[i]).callback.call(s.ctx);return;case 1:for(;++i<r;)(s=t[i]).callback.call(s.ctx,a);return;case 2:for(;++i<r;)(s=t[i]).callback.call(s.ctx,a,n);return;case 3:for(;++i<r;)(s=t[i]).callback.call(s.ctx,a,n,o);return;default:for(;++i<r;)(s=t[i]).callback.apply(s.ctx,e);return}};c.bind=c.on,c.unbind=c.off,s.extend(e,c);var y=e.Model=function(t,e){var i=t||{};e||(e={}),this.cid=s.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{}),i=s.defaults({},i,s.result(this,"defaults")),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};s.extend(y.prototype,c,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return s.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return s.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!s.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var r;if("object"==typeof t?(r=t,i=e):(r={})[t]=e,i||(i={}),!this._validate(r,i))return!1;var a=i.unset,n=i.silent,o=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=s.clone(this.attributes),this.changed={});var c=this.attributes,u=this.changed,h=this._previousAttributes;for(var d in r)e=r[d],s.isEqual(c[d],e)||o.push(d),s.isEqual(h[d],e)?delete u[d]:u[d]=e,a?delete c[d]:c[d]=e;if(this.id=this.get(this.idAttribute),!n){o.length&&(this._pending=i);for(var p=0;p<o.length;p++)this.trigger("change:"+o[p],this,c[o[p]],i)}if(l)return this;if(!n)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,s.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,s.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!s.isEmpty(this.changed):s.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&s.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,i={};for(var r in t){var a=t[r];s.isEqual(e[r],a)||(i[r]=a)}return!!s.size(i)&&i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},fetch:function(t){var e=this,i=(t=s.extend({parse:!0},t)).success;return t.success=function(s){var r=t.parse?e.parse(s,t):s;if(!e.set(r,t))return!1;i&&i.call(t.context,e,s,t),e.trigger("sync",e,s,t)},E(this,t),this.sync("read",this,t)},save:function(t,e,i){var r;null==t||"object"==typeof t?(r=t,i=e):(r={})[t]=e;var a=(i=s.extend({validate:!0,parse:!0},i)).wait;if(r&&!a){if(!this.set(r,i))return!1}else if(!this._validate(r,i))return!1;var n=this,o=i.success,l=this.attributes;i.success=function(t){n.attributes=l;var e=i.parse?n.parse(t,i):t;if(a&&(e=s.extend({},r,e)),e&&!n.set(e,i))return!1;o&&o.call(i.context,n,t,i),n.trigger("sync",n,t,i)},E(this,i),r&&a&&(this.attributes=s.extend({},l,r));var c=this.isNew()?"create":i.patch?"patch":"update";"patch"!==c||i.attrs||(i.attrs=r);var u=this.sync(c,this,i);return this.attributes=l,u},destroy:function(t){var e=this,i=(t=t?s.clone(t):{}).success,r=t.wait,a=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(s){r&&a(),i&&i.call(t.context,e,s,t),e.isNew()||e.trigger("sync",e,s,t)};var n=!1;return this.isNew()?s.defer(t.success):(E(this,t),n=this.sync("delete",this,t)),r||a(),n},url:function(){var t=s.result(this,"urlRoot")||s.result(this.collection,"url")||L();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},s.defaults({validate:!0},t))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=s.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,s.extend(e,{validationError:i})),!1)}});n(y,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var b=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,s.extend({silent:!0},e))},_={add:!0,remove:!0,merge:!0},S={add:!0,remove:!1},w=function(t,e,s){s=Math.min(Math.max(s,0),t.length);for(var i=Array(t.length-s),r=e.length,a=0;a<i.length;a++)i[a]=t[a+s];for(a=0;a<r;a++)t[a+s]=e[a];for(a=0;a<i.length;a++)t[a+r+s]=i[a]};s.extend(b.prototype,c,{model:y,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,s.extend({merge:!1},e,S))},remove:function(t,e){e=s.extend({},e);var i=!s.isArray(t);t=i?[t]:s.clone(t);var r=this._removeModels(t,e);return!e.silent&&r&&this.trigger("update",this,e),i?r[0]:r},set:function(t,e){if(null!=t){(e=s.defaults({},e,_)).parse&&!this._isModel(t)&&(t=this.parse(t,e));var i=!s.isArray(t);t=i?[t]:t.slice();var r=e.at;null!=r&&(r=+r),r<0&&(r+=this.length+1);for(var a,n=[],o=[],l=[],c={},u=e.add,h=e.merge,d=e.remove,p=!1,f=this.comparator&&null==r&&!1!==e.sort,g=s.isString(this.comparator)?this.comparator:null,m=0;m<t.length;m++){a=t[m];var v=this.get(a);if(v){if(h&&a!==v){var y=this._isModel(a)?a.attributes:a;e.parse&&(y=v.parse(y,e)),v.set(y,e),f&&!p&&(p=v.hasChanged(g))}c[v.cid]||(c[v.cid]=!0,n.push(v)),t[m]=v}else u&&(a=t[m]=this._prepareModel(a,e))&&(o.push(a),this._addReference(a,e),c[a.cid]=!0,n.push(a))}if(d){for(m=0;m<this.length;m++)c[(a=this.models[m]).cid]||l.push(a);l.length&&this._removeModels(l,e)}var b=!1,S=!f&&u&&d;if(n.length&&S?(b=this.length!=n.length||s.some(this.models,function(t,e){return t!==n[e]}),this.models.length=0,w(this.models,n,0),this.length=this.models.length):o.length&&(f&&(p=!0),w(this.models,o,null==r?this.length:r),this.length=this.models.length),p&&this.sort({silent:!0}),!e.silent){for(m=0;m<o.length;m++)null!=r&&(e.index=r+m),(a=o[m]).trigger("add",a,this,e);(p||b)&&this.trigger("sort",this,e),(o.length||l.length)&&this.trigger("update",this,e)}return i?t[0]:t}},reset:function(t,e){e=e?s.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,s.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,s.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,s.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return a.apply(this.models,arguments)},get:function(t){if(null!=t){var e=this.modelId(this._isModel(t)?t.attributes:t);return this._byId[t]||this._byId[e]||this._byId[t.cid]}},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=e.length;return s.isFunction(e)&&(e=s.bind(e,this)),1===i||s.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return s.invoke(this.models,"get",t)},fetch:function(t){var e=(t=s.extend({parse:!0},t)).success,i=this;return t.success=function(s){var r=t.reset?"reset":"set";i[r](s,t),e&&e.call(t.context,i,s,t),i.trigger("sync",i,s,t)},E(this,t),this.sync("read",this,t)},create:function(t,e){var i=(e=e?s.clone(e):{}).wait;if(!(t=this._prepareModel(t,e)))return!1;i||this.add(t,e);var r=this,a=e.success;return e.success=function(t,e,s){i&&r.add(t,s),a&&a.call(s.context,t,e,s)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;(e=e?s.clone(e):{}).collection=this;var i=new this.model(t,e);return i.validationError?(this.trigger("invalid",this,i.validationError,e),!1):i},_removeModels:function(t,e){for(var s=[],i=0;i<t.length;i++){var r=this.get(t[i]);if(r){var a=this.indexOf(r);this.models.splice(a,1),this.length--,e.silent||(e.index=a,r.trigger("remove",r,this,e)),s.push(r),this._removeReference(r,e)}}return!!s.length&&s},_isModel:function(t){return t instanceof y},_addReference:function(t,e){this._byId[t.cid]=t;var s=this.modelId(t.attributes);null!=s&&(this._byId[s]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var s=this.modelId(t.attributes);null!=s&&delete this._byId[s],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,s,i){if("add"!==t&&"remove"!==t||s===this){if("destroy"===t&&this.remove(e,i),"change"===t){var r=this.modelId(e.previousAttributes()),a=this.modelId(e.attributes);r!==a&&(null!=r&&delete this._byId[r],null!=a&&(this._byId[a]=e))}this.trigger.apply(this,arguments)}}});n(b,{forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3},"models");var j=e.View=function(t){this.cid=s.uniqueId("view"),s.extend(this,s.pick(t,x)),this._ensureElement(),this.initialize.apply(this,arguments)},$=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];s.extend(j.prototype,c,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=s.result(this,"events")),!t)return this;for(var e in this.undelegateEvents(),t){var i=t[e];if(s.isFunction(i)||(i=this[i]),i){var r=e.match($);this.delegate(r[1],r[2],s.bind(i,this))}}return this},delegate:function(t,e,s){return this.$el.on(t+".delegateEvents"+this.cid,e,s),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,s){return this.$el.off(t+".delegateEvents"+this.cid,e,s),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"));else{var t=s.extend({},s.result(this,"attributes"));this.id&&(t.id=s.result(this,"id")),this.className&&(t.class=s.result(this,"className")),this.setElement(this._createElement(s.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),e.sync=function(t,i,r){var a=k[t];s.defaults(r||(r={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var n={type:a,dataType:"json"};if(r.url||(n.url=s.result(i,"url")||L()),null!=r.data||!i||"create"!==t&&"update"!==t&&"patch"!==t||(n.contentType="application/json",n.data=JSON.stringify(r.attrs||i.toJSON(r))),r.emulateJSON&&(n.contentType="application/x-www-form-urlencoded",n.data=n.data?{model:n.data}:{}),r.emulateHTTP&&("PUT"===a||"DELETE"===a||"PATCH"===a)){n.type="POST",r.emulateJSON&&(n.data._method=a);var o=r.beforeSend;r.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",a),o)return o.apply(this,arguments)}}"GET"===n.type||r.emulateJSON||(n.processData=!1);var l=r.error;r.error=function(t,e,s){r.textStatus=e,r.errorThrown=s,l&&l.call(r.context,t,e,s)};var c=r.xhr=e.ajax(s.extend(n,r));return i.trigger("request",i,c,r),c};var k={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var T=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},q=/\((.*?)\)/g,C=/(\(\?)?:\w+/g,I=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;s.extend(T.prototype,c,{initialize:function(){},route:function(t,i,r){s.isRegExp(t)||(t=this._routeToRegExp(t)),s.isFunction(i)&&(r=i,i=""),r||(r=this[i]);var a=this;return e.history.route(t,function(s){var n=a._extractParameters(t,s);!1!==a.execute(r,n,i)&&(a.trigger.apply(a,["route:"+i].concat(n)),a.trigger("route",i,n),e.history.trigger("route",a,i,n))}),this},execute:function(t,e,s){t&&t.apply(this,e)},navigate:function(t,s){return e.history.navigate(t,s),this},_bindRoutes:function(){if(this.routes){this.routes=s.result(this,"routes");for(var t,e=s.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(A,"\\$&").replace(q,"(?:$1)?").replace(C,function(t,e){return e?t:"([^/?]+)"}).replace(I,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return s.map(i,function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null})}});var H=e.History=function(){this.handlers=[],this.checkUrl=s.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,Q=/^\/+|\/+$/g,O=/#.*$/;H.started=!1,s.extend(H.prototype,c,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(F,"")},start:function(t){if(H.started)throw new Error("Backbone.history has already been started");if(H.started=!0,this.options=s.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(Q,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,r=i.insertBefore(this.iframe,i.firstChild).contentWindow;r.document.open(),r.document.close(),r.location.hash="#"+this.fragment}var a=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?a("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?a("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),H.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),s.some(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0}))},navigate:function(t,e){if(!H.started)return!1;e&&!0!==e||(e={trigger:!!e}),t=this.getFragment(t||"");var s=this.root;""!==t&&"?"!==t.charAt(0)||(s=s.slice(0,-1)||"/");var i=s+t;if(t=this.decodeFragment(t.replace(O,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;e.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,s){if(s){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),e.history=new H;y.extend=b.extend=T.extend=j.extend=H.extend=function(t,e){var i,r=this;i=t&&s.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},s.extend(i,r,e);var a=function(){this.constructor=i};return a.prototype=r.prototype,i.prototype=new a,t&&s.extend(i.prototype,t),i.__super__=r.prototype,i};var L=function(){throw new Error('A "url" property or function must be specified')},E=function(t,e){var s=e.error;e.error=function(i){s&&s.call(e.context,t,i,e),t.trigger("error",t,i,e)}};return e}),function(){Date.shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Date.longMonths=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.shortDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Date.longDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var t={d:function(){return(this.getDate()<10?"0":"")+this.getDate()},D:function(){return Date.shortDays[this.getDay()]},j:function(){return this.getDate()},l:function(){return Date.longDays[this.getDay()]},N:function(){return 0==this.getDay()?7:this.getDay()},S:function(){return this.getDate()%10==1&&11!=this.getDate()?"st":this.getDate()%10==2&&12!=this.getDate()?"nd":this.getDate()%10==3&&13!=this.getDate()?"rd":"th"},w:function(){return this.getDay()},z:function(){var t=new Date(this.getFullYear(),0,1);return Math.ceil((this-t)/864e5)},W:function(){var t=new Date(this.valueOf()),e=(this.getDay()+6)%7;t.setDate(t.getDate()-e+3);var s=t.valueOf();t.setMonth(0,1),4!==t.getDay()&&t.setMonth(0,1+(4-t.getDay()+7)%7);var i=1+Math.ceil((s-t)/6048e5);return i<10?"0"+i:i},F:function(){return Date.longMonths[this.getMonth()]},m:function(){return(this.getMonth()<9?"0":"")+(this.getMonth()+1)},M:function(){return Date.shortMonths[this.getMonth()]},n:function(){return this.getMonth()+1},t:function(){var t=this.getFullYear(),e=this.getMonth()+1;return 12===e&&(t=t++,e=0),new Date(t,e,0).getDate()},L:function(){var t=this.getFullYear();return t%400==0||t%100!=0&&t%4==0},o:function(){var t=new Date(this.valueOf());return t.setDate(t.getDate()-(this.getDay()+6)%7+3),t.getFullYear()},Y:function(){return this.getFullYear()},y:function(){return(""+this.getFullYear()).substr(2)},a:function(){return this.getHours()<12?"am":"pm"},A:function(){return this.getHours()<12?"AM":"PM"},B:function(){return Math.floor(1e3*((this.getUTCHours()+1)%24+this.getUTCMinutes()/60+this.getUTCSeconds()/3600)/24)},g:function(){return this.getHours()%12||12},G:function(){return this.getHours()},h:function(){return((this.getHours()%12||12)<10?"0":"")+(this.getHours()%12||12)},H:function(){return(this.getHours()<10?"0":"")+this.getHours()},i:function(){return(this.getMinutes()<10?"0":"")+this.getMinutes()},s:function(){return(this.getSeconds()<10?"0":"")+this.getSeconds()},u:function(){var t=this.getMilliseconds();return(t<10?"00":t<100?"0":"")+t},e:function(){return/\((.*)\)/.exec((new Date).toString())[1]},I:function(){for(var t=null,e=0;e<12;++e){var s=new Date(this.getFullYear(),e,1).getTimezoneOffset();if(null===t)t=s;else{if(s<t){t=s;break}if(s>t)break}}return this.getTimezoneOffset()==t|0},O:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.floor(Math.abs(this.getTimezoneOffset()/60))+(0==Math.abs(this.getTimezoneOffset()%60)?"00":(Math.abs(this.getTimezoneOffset()%60)<10?"0":"")+Math.abs(this.getTimezoneOffset()%60))},P:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.floor(Math.abs(this.getTimezoneOffset()/60))+":"+(0==Math.abs(this.getTimezoneOffset()%60)?"00":(Math.abs(this.getTimezoneOffset()%60)<10?"0":"")+Math.abs(this.getTimezoneOffset()%60))},T:function(){return this.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1")},Z:function(){return 60*-this.getTimezoneOffset()},c:function(){return this.format("Y-m-d\\TH:i:sP")},r:function(){return this.toString()},U:function(){return this.getTime()/1e3}};Date.prototype.format=function(e){var s=this;return e.replace(/(\\?)(.)/g,function(e,i,r){return""===i&&t[r]?t[r].call(s):r})}}.call(this);var SearchController=Backbone.Model.extend({defaults:function(){return{host_app:"",customer_id:0,query_typed:"",lang:{},query_string:"",baseUrl:"",layout:"tab",sources:[],tab_order:[],tab:"",selector:"",form_selector:"",header_selector:"",form_queue_id:0,guide_id:0,debug:!1}},initialize:function(){if(this.set("baseUrl",location.pathname),this.protocol=window.location.protocol,this.useHistory=!1,window.history&&void 0!==history.pushState){this.useHistory=!0,this.History=window.History;var t=this;this.History.Adapter.bind(window,"statechange",function(){t.retrieve()})}if(_.templateSettings={escape:/\{\{\{([^#].*?)\}\}\}/g,interpolate:/\{\{([^#\{][\s\S]*?)\}\}/g,evaluate:/\{\{#([\s\S]+?)\}\}/g},this.on("search",this.pushState,this),this.on("change:query_typed",this.updateQuery,this),"bento"==this.get("layout")&&jQuery("body").addClass("s-srch-layout-bento"),"tab"==this.get("layout")&&0==this.get("tab_order").length){var e=[],s=jQuery(this.get("selector")).attr("data-srch-sources");void 0!==s&&""!==s?(s=s.split(","),_.each(s,function(t){var s=_.findWhere(this.get("sources"),{id:parseInt(t,10)});void 0!==s&&e.push(s.id)},this),0==e.length&&(e=_.map(this.get("sources"),function(t){return t.id}))):_.each(this.get("sources"),function(t,s,i){e.push(t.id)}),this.set("tab_order",e)}"tab"==this.get("layout")&&""===this.get("tab")&&this.set("tab",this.get("tab_order")[0]);var i=[];if(""!==this.get("form_selector")&&jQuery(this.get("form_selector")).length>0)var r=new SearchForm({model:this,el:jQuery(this.get("form_selector")),formType:"existing"});else{r=new SearchForm({model:this,id:"s-srch-form"});i.push(r.el)}if("tab"==this.get("layout")&&this.get("tab_order").length>1){var a=new SearchTabs({model:this,id:"s-srch-tabs"});i.push(a.el)}i.length>0&&jQuery(this.get("selector")).append(i)},debug:function(t){this.get("debug")&&console.log(t)},loadSources:function(){if("tab"==this.get("layout")){if(_.each(this.get("tab_order"),function(t,e,s){var i=_.findWhere(this.get("sources"),{id:parseInt(t,10)});if(void 0!==i){i.id;var r=jQuery('<div id="s-srch-source-'+i.id+'"></div>').attr({"data-source":i.id,role:"tabpanel"});this.get("tab")!=i.id&&r.addClass("hidden"),jQuery(this.get("selector")).append(r),i.lang=this.get("lang"),i.guide_id=this.get("guide_id");var a=[];switch(i.type){case"la":a.push(new SearchLA(i));break;case"lg":a.push(new SearchLG(i));break;case"az":a.push(new SearchAZ(i));break;case"blog":a.push(new SearchBlog(i));break;default:a.push(new SearchInterface(i))}}},this),"la"==this.get("host_app")){var t=new AskView({model:this,formtype:"footer",alert_text:this.get("lang").srch_askqtext});jQuery(this.get("selector")).append(t.el)}}else _.each(this.get("sources"),function(t,e,s){var i="#s-srch-source-"+t.id;if(0!=jQuery(i).length){t.display_facets=!1,t.lang=this.get("lang");var r=[];switch(t.type){case"la":r.push(new SearchLA(t));break;case"lg":r.push(new SearchLG(t));break;case"az":r.push(new SearchAZ(t));break;case"blog":r.push(new SearchBlog(t));break;default:r.push(new SearchInterface(t))}}},this)},pushState:function(){this.debug("searchcontroller:pushState");var t=this.buildQueryString();""!==t&&(t="?"+t),this.useHistory?this.History.pushState(null,null,this.get("baseUrl")+t):window.location(this.get("baseUrl")+t)},retrieve:function(){this.debug("searchcontroller:retrieve"),this.parseQueryString(),this.trigger("search:initiate",{source:"controller"})},parseQueryString:function(){var t=location.search.slice(1);this.set("query_string",t);var e=t.split("&"),s={};return _.each(e,function(t){""!=(t=t.split("="))[0]&&t[1]&&(t[0],s[t[0]]=decodeURIComponent(t[1].replace(/\+/g," ")||""))},this),s.q?this.set("query_typed",s.q):this.set("query_typed",""),s.t&&this.set("tab",s.t),s.topics&&"tab"==this.get("layout")&&this.trigger("facet:set",{facet:"topics",value:s.topics}),s.keywords&&"tab"==this.get("layout")&&this.trigger("facet:set",{facet:"keywords",value:s.keywords}),s.g&&"tab"==this.get("layout")&&this.trigger("facet:set",{facet:"g",value:s.g}),s.subject&&"tab"==this.get("layout")&&this.trigger("facet:set",{facet:"subject",value:s.subject}),s.tag&&"tab"==this.get("layout")&&this.trigger("facet:set",{facet:"tag",value:s.tag}),s.group&&"tab"==this.get("layout")&&this.trigger("facet:set",{facet:"group",value:s.group}),s.content_type&&"tab"==this.get("layout")&&this.trigger("facet:set",{facet:"content_type",value:s.content_type}),s.guide_type&&"tab"==this.get("layout")&&this.trigger("facet:set",{facet:"guide_type",value:s.guide_type}),s},buildQueryString:function(){var t={};""!==this.get("query_typed")&&(t.q=this.get("query_typed")),""!==this.get("tab")&&(t.t=this.get("tab"));var e=jQuery.param(t,!0);return this.set("query_string",e),e},updateQuery:function(){var t=this.get("query_typed");$("textarea[name=pdetails]").val(t),$(this.get("header_selector")).text(this.get("lang").srch_boxhead+" ").append(jQuery("<em></em>").text(t))}}),SearchForm=Backbone.View.extend({model:SearchController,tagName:"form",className:"form-inline",formType:"",events:{submit:"submit"},initialize:function(t){t.formType&&(this.formType=t.formType),this.render();var e=this.model.get("query_typed");if("tab"==this.model.get("layout")){var s=jQuery(this.model.get("selector")),i=s.attr("id");""==i&&(i="s-srch-results-container",s.attr("id",i)),this.$input.attr("aria-controls",i)}this.$input.val(e),this.listenTo(this.model,"change:query_typed",this.setQuery)},render:function(){if("existing"!=this.formType){var t=[];this.$input=jQuery('<input type="text" class="s-srch-form-input form-control" id="primaryquery" name="q" value="" />');var e=jQuery('<label for="" class="control-label sr-only" for="primaryquery">Keyword Search</label>');t.push(jQuery('<div class="form-group"></div>').append([e,this.$input])),t.push(jQuery('<button type=submit class="btn btn-default">Search</button>')),this.$el.append(t)}else this.$input=this.$("input[name=q]")},setQuery:function(t){this.$input.val(this.model.get("query_typed"))},submit:function(t){t.preventDefault();var e=this.$input.val();if(e!==this.model.get("query_typed")){if((e.match(/"/g)||[]).length%2!=0)return void errorAlert(this.model.get("lang").srch_syntaxerror);this.model.set("query_typed",e),this.model.trigger("search")}}}),SearchTabs=Backbone.View.extend({model:SearchController,tagName:"div",id:"s-srch-tabs",events:{"click button":"changeTab"},initialize:function(){if(this.model.debug("SearchTabs:initialize"),"tab"!==this.model.get("layout"))return!1;this.render(),this.listenTo(this.model,"change:tab",this.setTab)},changeTab:function(t){t.preventDefault();var e=$(t.currentTarget).parent("li");if(!e.hasClass("active")){this.$("li").removeClass("active"),this.$("button").attr({"aria-selected":"false"}),e.addClass("active"),e.find("button").attr({"aria-selected":"true"});var s=e.attr("data-source");this.model.set("tab",s),this.model.trigger("search")}},setTab:function(){var t=this.model.get("tab");this.$("li").removeClass("active"),this.$("button").attr({"aria-selected":"false"}),this.$("li[data-source="+t+"]").addClass("active").find("button").attr({"aria-selected":"true"})},render:function(){this.model.debug("SearchTabs:render"),this.$el.html("");var t=jQuery("<ul></ul>").addClass("list-inline").attr({role:"tablist"}),e=this.model.get("tab");this.model.debug(e),_.each(this.model.get("tab_order"),function(s,i,r){var a=_.findWhere(this.model.get("sources"),{id:parseInt(s,10)});if(void 0!==a){var n=jQuery("<li></li>").attr({"data-source":a.id,role:"presentation"}),o=jQuery("<button></button>").attr({type:"button","aria-controls":"s-srch-source-"+a.id,role:"tab"}).addClass("btn btn-default").text(a.name);e==a.id&&(n.addClass("active"),o.attr({"aria-selected":"true"})),n.append(o),t.append(n)}},this),this.model.debug(this.$el),this.$el.append(t)}}),AskView=Backbone.View.extend({model:SearchController,tagName:"div",className:"s-srch-askbutton col-sm-12 hidden",formtype:"noresults",alert_text:"No results found.",events:{"click .btn":"showQForm"},initialize:function(t){t.formtype&&(this.formtype=t.formtype),t.alert_text&&(this.alert_text=t.alert_text),this.listenTo(this.model,"search:retrieve",this.results),this.listenTo(this.model,"search:noresults",this.noresults),this.listenTo(this.model,"askform:results",this.results),this.listenTo(this.model,"askform:noresults",this.noresults),this.render()},render:function(){var t=$('<p class="alert alert-info"></p>').html(this.alert_text);if(searchcontroller.get("form_queue_id")>0){var e=$('<a class="btn btn-primary" href="#" role=button></a>').html(this.model.get("lang").srch_askqbutton);t.append(e)}this.$el.html(t)},results:function(){"noresults"==this.formtype?this.$el.addClass("hidden").attr("aria-hidden","true"):this.$el.removeClass("hidden").attr("aria-hidden","false")},noresults:function(t){"noresults"==this.formtype?this.$el.removeClass("hidden").attr("aria-hidden","false"):this.$el.addClass("hidden").attr("aria-hidden","true")},showQForm:function(t){t.preventDefault();var e=this.model.get("query_typed"),s=searchcontroller.get("form_queue_id");window.addEventListener("message",function(t){t.data&&_.isObject(t.data)&&t.data.action&&"qformloaded"==t.data.action&&t.data.height&&parseInt(t.data.height,10)>0&&jQuery(".qform_frame").css("height",t.data.height)});var i=0;springSpace&&springSpace.querySpy&&(i=springSpace.querySpy.qlog_id||0);new springSpace.sui.modal({title:this.model.get("lang").srch_askqbutton,content:'<iframe class="qform_frame" src="/form.php?queue_id='+s+"&iframe=1&qlog_id="+i+"&pquestion="+e+'"></iframe>',callback:function(){}})}});function compareArrays(t,e){if(t=t.sort(),e=e.sort(),t.length!=e.length)return!1;for(var s=0,i=t.length;s<i;s++)if(t[s]instanceof Array&&e[s]instanceof Array){if(!t[s].compare(e[s]))return!1}else if(t[s]!=e[s])return!1;return!0}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var SearchInterface=Backbone.Model.extend({defaults:function(){return{id:"",type:"",name:"",site_url:"",search_url:"",results:[],total_results:0,page:1,perpage:20,query_typed:null,query_obj:{},request_url:"",display_facets:!1,item_template:"",item_callback:"",sort_options:[],sort:{field:"",dir:""}}},initialize:function(t){searchcontroller.debug("SearchInterface "+this.get("type")+" initialize"),this.resultCache={},this.facetCache={},this.protocol=window.location.protocol,this.setConfig(t),"bento"==searchcontroller.get("layout")&&this.set("perpage",10),""===this.get("search_url")||_.isNull(this.get("search_url"))||"http"!==this.get("search_url").substr(0,4)&&"//"!==this.get("search_url").substr(0,2)&&this.set("search_url","//"+this.get("search_url")),this.listenTo(searchcontroller,"search:initiate",this.newSearch),this.on("search:initiate",this.newSearch,this),this.on("search:noresults",this.controllerno,this),this.on("search:retrieve",this.controlleryes,this),this.renderViews()},controllerno:function(){searchcontroller.trigger("search:noresults",{source:this.get("id")})},controlleryes:function(){searchcontroller.trigger("search:retrieve",{source:this.get("id")})},setConfig:function(t){_.each(t,function(t,e,s){_.isNull(t)||this.set(e,t,{silent:!0})},this),this.set("selector","#s-srch-source-"+this.get("id"),{silent:!0})},renderViews:function(){var t=jQuery(this.get("selector")),e=[],s=new SearchHeader({model:this,id:"s-srch-header-"+this.get("id")});if("bento"!==searchcontroller.get("layout"))var i=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-top",location:"top"}),r={$el:""};else i={$el:""},r=new SearchFooter({model:this,id:"s-srch-footer-"+this.get("id")});var a=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-bottom",location:"bottom"}),n=new ResultsList({model:this,id:"s-srch-results-"+this.get("id")});""!==this.get("description")&&e.push(jQuery('<div class="row"></div>').append(jQuery("<div>").addClass("col-sm-12 s-srch-description").attr("id","s-srch-description-"+this.get("id")).append(jQuery("<p>").html(this.get("description"))))),e.push(jQuery('<div class="row"></div>').append([s.$el,i.$el])),e.push(jQuery('<div class="row"></div>').append(n.$el)),e.push(jQuery('<div class="row"></div>').append([r.$el,a.$el])),t.append(e)},buildQuery:function(t){qo={q:this.convertSearch(),page:this.get("page")},null!==this.get("request_url").match(/^\/[^/]/)&&(qo.search_src_id=this.get("id")),s=this.get("sort"),qo.sort=s.field+"_"+s.dir,this.get("query_const")&&_.each(this.get("query_const"),function(t,e){qo[e]=t},this),this.set("query_obj",qo)},convertSearch:function(){return null===this.get("query_typed")?"":this.get("query_typed")},newSearch:function(t){if(searchcontroller.debug(this.get("type")+" newSearch"),"bento"!==searchcontroller.get("layout")){if(parseInt(searchcontroller.get("tab"),10)!==parseInt(this.get("id"),10))return void jQuery(this.get("selector")).addClass("hidden");jQuery(this.get("selector")).removeClass("hidden")}"controller"!=t.source||null===this.get("query_typed")||this.get("query_typed")!==searchcontroller.get("query_typed")?(this.set("query_typed",searchcontroller.get("query_typed")),"paginate"!==t.source&&this.set("page",1),this.retrieve()):0==this.get("total_results")?searchcontroller.trigger("askform:noresults"):searchcontroller.trigger("askform:results")},retrieve:function(){searchcontroller.debug(this.get("type")+" retrieve"),this.buildQuery();var t=JSON.stringify(this.get("query_obj"));if(this.resultCache[t])return this.parseResults(this.resultCache[t]),void this.setFocus();this.requestData()},requestData:function(){var t=this;workingAlert();try{$.ajax({url:this.get("request_url"),data:this.get("query_obj"),success:function(s,i){clearTimeout(e),t.cacheResults(s),t.parseResults(s),t.setFocus(),stopAlert()},dataType:"jsonp"});var e=setTimeout(function(){errorAlert()},1e4)}catch(t){searchcontroller.debug("requestData exception for source "+this.get("id")+": "+t.message),errorAlert()}},cacheResults:function(t){this.resultCache[JSON.stringify(this.get("query_obj"))]=t},cacheFacets:function(t,e){this.facetCache[t]=e},retrieveFacets:function(){},parseFacets:function(t){},parseResults:function(t){var e={results:[],total_results:0,perpage:0};if(_.isObject(t)&null!=t&&(e.results=t.results?t.results:[],e.total_results=t.total_results?t.total_results:0,e.perpage=t.perpage?t.perpage:0,t.sort&&(e.sort=t.sort),t.sort_options&&(e.sort_options=t.sort_options)),this.set(e),0===e.total_results?this.trigger("search:noresults"):this.trigger("search:retrieve"),this.get("display_facets")&&this.retrieveFacets(),this.get("query_const")){var s=_.clone(this.get("query_const")),i=!1;_.each(s,function(e,r){t[r]&&(s[r]=t[r],i=!0)},this),i&&this.set("query_const",s,{silent:!0})}},addFacet:function(t,e){var s=this.get("facets");s[t]&&-1==_.indexOf(s[t],e)&&(s[t].push(e),this.trigger("search:initiate",{source:"facet"}),this.trigger("facet:add",{type:t,value:e}))},setFacet:function(t,e,s,i){searchcontroller.debug(this.get("type")+" setFacet");var r=_.clone(this.get("facets"));void 0===s||s?(f=_.keys(r),r={},_.each(f,function(t){r[t]=[]},this),r[t].push(e)):r[t]=[e],this.set("facets",r),(void 0===i||i)&&this.trigger("search:initiate",{source:"facet"})},removeFacet:function(t,e){var s=_.clone(this.get("facets"));if(void 0===t&&(f=_.keys(s),s={},_.each(f,function(t){s[t]=[]},this),this.set("facets",s),this.trigger("search:initiate",{source:"facet"})),s[t]){if(void 0===e)s[t]=[];else{var i=_.indexOf(s[t],e);i>-1&&s[t].splice(i,1)}this.set("facets",s),this.trigger("search:initiate",{source:"facet"})}},removeAllFacets:function(t){void 0===t&&(t=!1);var e=_.clone(this.get("facets"));f=_.keys(e),e={},_.each(f,function(t){e[t]=[]},this),this.set("facets",e),t&&""!==this.get("query_typed")?(searchcontroller.set("query_typed",""),searchcontroller.trigger("search")):this.trigger("search:initiate",{source:"facet"})},setFocus:function(){""!==this.get("focus_target")&&(jQuery("#"+this.get("focus_target")).focus(),this.set("focus_target",""))}}),ResultsList=Backbone.View.extend({model:SearchInterface,tagName:"div",className:"s-srch-resultlist col-sm-12",item_template:"",attributes:{"aria-live":"polite"},initialize:function(t){searchcontroller.debug("ResultsList:initialize"),this.listenTo(this.model,"search:retrieve",this.render),this.listenTo(this.model,"search:noresults",this.noResults)},render:function(){var t=$('<ul class="list-unstyled s-srch-results"></ul>'),e=this.model.get("results");if(e&&e.length>0&&_.each(e,function(e,s,i){t.append(this.resultItem(e))},this),this.$el.html(t).attr({"aria-labelledby":"s-srch-params-"+this.model.get("id")}),""!==this.model.get("item_callback")){var s=new Function(this.model.get("item_callback"));t.find("li").each(function(t,e){s.apply(this)})}return this},noResults:function(){return $(this.el).html(""),this},resultItem:function(t){var e=$("<li></li>").addClass("s-srch-result"),s="";""===this.model.get("item_template")&&this.model.set("item_template",'<a href="{{url}}">{{title}}</a>',{silent:!0}),""===this.item_template&&(this.item_template=_.template(this.model.get("item_template")));try{s=this.item_template(t)}catch(t){return searchcontroller.debug(t),""}return e.html(s)}}),SearchHeader=Backbone.View.extend({model:SearchInterface,tagName:"div",className:"s-srch-header clearfix",events:{"click .s-srch-sorter":"doSort"},initialize:function(){"bento"==searchcontroller.get("layout")?this.$el.addClass("col-sm-12"):this.$el.addClass("col-sm-6"),this.render(),this.listenTo(this.model,"search:retrieve search:noresults",this.render)},render:function(){this.$el.html("");var t=this.model.get("total_results"),e=this.model.get("perpage"),s=(this.model.get("page")-1)*e;this.$rangeHeader=$('<div class="s-srch-range pull-left"></div>'),this.$rangeHeader.html($("<span></span>").text(springSpace.Util.stringFormat(this.model.get("lang").srch_resrange,[Math.min(t,s+1)+" - "+Math.min(t,s+e),t])));var i="";if(this.model.get("sort_options").length>1){var r=this.model.get("sort");_.each(this.model.get("sort_options"),function(t,e){var s=r.field==t.field&&r.dir==t.dir?'<i class="fa fa-fw fa-check"></i>':'<i class="fa fa-fw"></i>';i+='<li><a href="#" role=button class="s-srch-sorter" data-field="'+t.field+'" data-direction="'+t.dir+'" aria-controls="s-srch-results-'+this.model.get("id")+'">'+s+" "+t.label+"</a></li>"},this)}if(""!==i){var a='<div class="dropdown"><button id="s-srch-sort-'+this.model.get("id")+'-btn" type="button" class="btn btn-default btn-xs" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'+this.model.get("lang").srch_sorthead+' <span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="s-srch-sort-'+this.model.get("id")+'-btn">'+i+"</ul></div>";this.$rangeHeader.append(a)}this.$el.append([this.$rangeHeader])},doSort:function(t){t.preventDefault();var e=$(t.currentTarget),s=e.attr("data-field"),i=e.attr("data-direction");this.model.set("sort",{field:s,dir:i}),this.model.set("focus_target",this.$(".dropdown button").attr("id")),this.model.trigger("search:initiate",{source:"sort"})}}),SearchFooter=Backbone.View.extend({model:SearchInterface,tagName:"div",className:"s-srch-footer clearfix col-sm-6",events:{},initialize:function(){this.render(),this.listenTo(this.model,"search:retrieve search:noresults",this.render)},render:function(){if(this.$el.html(""),"bento"==searchcontroller.get("layout")&&this.model.get("search_url")){var t=jQuery("<div></div>").addClass("s-srch-fulllink"),e=this.model.get("query_typed")?this.model.get("query_typed"):"",s=this.model.get("search_url").replace("{{query}}",encodeURIComponent(e)),i=jQuery("<a></a>").html('<i class="fa fa-external-link"></i> '+this.model.get("lang").srch_seemore).attr({href:s,target:"_blank"});t.append(i),this.$el.append(t)}}}),PaginationView=Backbone.View.extend({model:SearchInterface,tagName:"div",className:"s-srch-pagination",location:"top",events:{"click .pagination a":"changePage"},initialize:function(t){t.location&&(this.location=t.location),"bottom"==this.location?"bento"==searchcontroller.get("layout")?this.$el.addClass("s-srch-pagination-bottom col-sm-6"):this.$el.addClass("s-srch-pagination-bottom col-sm-12"):"bento"==searchcontroller.get("layout")?this.$el.addClass("col-sm-4"):this.$el.addClass("col-sm-6"),this.render(),this.listenTo(this.model,"search:retrieve search:noresults",this.render)},render:function(){var t=this.model.get("total_results"),e=this.model.get("perpage");this.$pager=$('<ul class="pagination pull-right" role="listbox"></ul>').attr("aria-label",this.model.get("lang").srch_pagelabel);var s=Math.ceil(t/e),i=parseInt(this.model.get("page"),10);if(s>1){var r=[];if(i>1){c=i-1;var a=$('<li class="pager-step" role="presentation"></li>'),n=$("<a>&lt;</a>").attr({href:"#","data-page":c,"aria-controls":"s-srch-results-"+this.model.get("id"),role:"option"});a.append(n),r.push(a)}var o=i-2<1?1:i-2,l=o+4;l>s&&(l=s);for(var c=o;c<=l;){a=$('<li role="presentation"></li>'),n=$("<a>"+c+"</a>").attr({href:"#","data-page":c,"aria-controls":"s-srch-results-"+this.model.get("id"),role:"option"});c==i&&(a.addClass("active"),n.attr({"aria-selected":"true"})),a.append(n),r.push(a),c++}if(i<s){c=i+1,a=$('<li class="pager-step" role="presentation"></li>'),n=$("<a>&gt;</a>").attr({href:"#","data-page":c,"aria-controls":"s-srch-results-"+this.model.get("id"),role:"option"});a.append(n),r.push(a)}this.$pager.append(r)}this.$el.html(this.$pager)},changePage:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-page");this.model.get("page")!==e&&(this.model.set("page",e),this.model.trigger("search:initiate",{source:"paginate"}))}}),FacetView=Backbone.View.extend({model:SearchInterface,tagName:"div",className:"s-srch-facet",facetType:"",events:{"change input[type=checkbox]":"toggleFacet","hide.bs.collapse .s-srch-cloud":"toggleCollapseIcon","show.bs.collapse .s-srch-cloud":"toggleCollapseIcon"},initialize:function(t){t.facetType&&(this.facetType=t.facetType),this.listenTo(this.model,"facets:retrieve",this.makeList),this.render()},render:function(){return this},makeList:function(){},toggleFacet:function(t){var e=$(t.currentTarget),s=e.attr("name");!0===e.prop("checked")?this.model.addFacet(this.facetType,s):this.model.removeFacet(this.facetType,s)},toggleCollapseIcon:function(t){var e=jQuery(t.currentTarget).prev("h3").find("button span i");0!==e.length&&("hide"==t.type?e.removeClass("fa-caret-down").addClass("fa-caret-right"):"show"==t.type&&e.removeClass("fa-caret-right").addClass("fa-caret-down"))}}),CurrentParamsView=Backbone.View.extend({model:SearchInterface,tagName:"div",className:"col-sm-12 hidden",events:{"click .removeAll":"removeAll"},initialize:function(){this.render(),this.listenTo(this.model,"search:retrieve search:noresults",this.render)},render:function(){return this},removeAll:function(t){t.preventDefault(),this.model.removeFacet()}}),SearchLA=SearchInterface.extend({setConfig:function(t){var e={iid:0,isDefaultGroup:!0,group_id_default:[],groups_available:[],group_data:{},display_facets:!0,facets:{topics:[],keywords:[],g:[]},sort:{field:"_score",dir:"desc"},sort_options:[{field:"_score",dir:"desc",label:this.get("lang").srch_sortlabelrel},{field:"updated",dir:"desc",label:this.get("lang").srch_sortlabeldatedesc}],query_facet_results:{},facet_results:{},searchwt:{question:"6",details:"3",topics:"4",keywords:"5",allInOne:"1"}};if(_.extend(e,t),_.each(e,function(t,e,s){this.set(e,t,{silent:!0})},this),0===this.get("groups_available").length){var s=[];_.each(this.get("group_data"),function(t,e){s.push(t.id)},this),this.set("groups_available",s)}0===this.get("group_id_default").length&&this.set("group_id_default",this.get("groups_available")),this.set("selector","#s-srch-source-"+this.get("id"),{silent:!0}),1===this.get("group_id_default").length&&this.setLAFacet({facet:"g",value:this.get("group_id_default")[0]}),this.listenTo(searchcontroller,"facet:set",this.setLAFacet)},setLAFacet:function(t){t.facet&&""!==t.facet&&t.value&&""!==t.value&&this.get("facets")[t.facet]&&this.setFacet(t.facet,t.value,!1,!1)},renderViews:function(){var t=jQuery(this.get("selector")),e=[],s=new SearchHeader({model:this,id:"s-srch-header-"+this.get("id")});if("bento"!==searchcontroller.get("layout"))var i=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-top",location:"top"}),r={$el:""};else i={$el:""},r=new SearchFooter({model:this,id:"s-srch-footer-"+this.get("id")});var a=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-bottom",location:"bottom"}),n=new LACurrentParamsView({model:this,id:"s-srch-params-"+this.get("id")}),o=new LAResultsList({model:this,id:"s-srch-results-"+this.get("id")}),l=new AskView({model:this,formType:"noresults",alert_text:this.get("lang").srch_notasked,source:this.get("id")});if(""!==this.get("description")&&e.push(jQuery('<div class="row"></div>').append(jQuery("<div>").addClass("col-sm-12 s-srch-description").attr("id","s-srch-description-"+this.get("id")).append(jQuery("<p>").html(this.get("description"))))),e.push(jQuery('<div class="row"></div>').append([s.$el,i.$el])),"bento"!==searchcontroller.get("layout")&&e.push(jQuery('<div class="row"></div>').append(n.$el)),e.push(jQuery('<div class="row"></div>').append(o.$el)),e.push(jQuery('<div class="row"></div>').append([r.$el,a.$el])),e.push(jQuery('<div class="row"></div>').append(l.$el)),!0===this.get("display_facets")){var c=jQuery('<div class="col-md-9"></div>').append(e),u=jQuery('<div class="col-md-3"></div>'),h=[];_.each(this.get("facets"),function(t,e,s){h.push(new LAFacetView({model:this,id:"s-srch-facet-"+this.get("id")+"-"+e,facetType:e}))},this),_.each(h,function(t,e){u.append(t.$el)},this),t.append(jQuery('<div class="row"></div>').append(c,u))}else t.append(e)},buildQuery:function(t){void 0===t&&(t=!1),qo={search_source_id:this.get("id"),rows:this.get("perpage"),iid:this.get("iid"),searchwt:JSON.stringify(this.get("searchwt"))};var e=this.get("facets");if(e.g&&e.g.length>0){var s=[];_.each(e.g,function(t){-1!=this.get("groups_available").indexOf(t)&&s.push(t)},this),qo.group_ids=s}else this.get("group_id_default").length>0?qo.group_ids=this.get("group_id_default"):qo.group_ids=this.get("groups_available");qo.group_ids=JSON.stringify(qo.group_ids);var i=this.get("page");if(qo.start=qo.rows*(i-1),t)return qo.facet=!1,qo;_.each(e,function(t,e,s){if("g"!=e){t.length>0&&(qo[e]=JSON.stringify(t))}},this),qo.q=this.convertSearch();var r=this.get("sort");qo.sort=r.field+" "+r.dir,this.set("query_obj",qo)},convertSearch:function(){return this.get("query_typed")},requestData:function(){var t=this;workingAlert(),$.ajax({url:this.protocol+"//"+this.get("request_url"),data:this.get("query_obj"),success:function(s,i){clearTimeout(e),t.cacheResults(s),t.parseResults(s),t.setFocus(),stopAlert()},dataType:"jsonp"});var e=setTimeout(function(){errorAlert()},1e4);if(void 0!==springSpace.querySpy)try{var s=this.get("query_typed");if(""==s||"*:*"==s)return;springSpace.querySpy.record({query:s})}catch(t){searchcontroller.debug(t)}},retrieveFacets:function(){qo={search_source_id:this.get("id"),rows:0,iid:this.get("iid"),searchwt:JSON.stringify(this.get("searchwt"))};var t=this.get("facets");if(t.g.length>0){var e=[];_.each(t.g,function(t,s,i){e.push(t)},this),qo.group_ids=e}else{var s=this.get("groups_available");1==s.length?qo.group_ids=[s[0]]:this.get("group_id_default").length>0?qo.group_ids=this.get("group_id_default"):qo.group_ids=s}if(qo.group_ids=JSON.stringify(qo.group_ids),qo.q=this.convertSearch(),this.facetCache[jQuery.param(qo,!0)])this.parseFacets(this.facetCache[jQuery.param(qo,!0)]);else{var i=this;$.ajax({url:this.protocol+"//"+this.get("request_url"),data:qo,success:function(t,e){i.cacheFacets(jQuery.param(qo,!0),t),i.parseFacets(t)},dataType:"jsonp"})}},parseFacets:function(t){this.set("facet_results",t.facets),this.trigger("facets:retrieve")},parseResults:function(t){this.set({results:t.results,total_results:t.total_results,query_facet_results:t.facets}),0==t.total_results?this.trigger("search:noresults"):this.trigger("search:retrieve"),this.get("display_facets")&&this.retrieveFacets()}}),LAResultsList=ResultsList.extend({events:{"click .s-srch-result-subj a":"setFacet","click .s-srch-result-title a":"gotoAnswer","contextmenu .s-srch-result-title a":"gotoAnswer"},render:function(){var t=$('<ul class="list-unstyled s-srch-results"></ul>'),e=this.model.get("results");e.length>0&&_.each(e,function(e){t.append(this.resultItem(e))},this),this.$el.html(t);try{window.self!==window.top&&$(".s-la-faq-listing-q a").attr("target","_parent")}catch(t){}return this},noResults:function(){return $(this.el).html(""),this},resultItem:function(t){var e=$("<li></li>").addClass("s-srch-result"),s="";if(!t.faqid||!t.group_id||!t.question)return"";var i=""==this.model.get("site_url")?"/":"//"+this.model.get("site_url"),r=""==this.model.get("group_data")[t.group_id].slug?"faq/"+t.faqid:this.model.get("group_data")[t.group_id].slug+"/faq/"+t.faqid;if(t.url=("/"==i?i:i+"/")+r,!t.updated_formatted){var a=new Date(t.updated);t.updated_formatted=a.format(this.model.get("lang").Dt_DateTime)}t.topics_text=t.topics_text?t.topics_text:[],""===this.model.get("item_template")&&("bento"==searchcontroller.get("layout")?this.model.set("item_template",'<div class=s-srch-result-title><a href="{{url}}" data-faqid={{faqid}}>{{question}}</a></div><div class="s-srch-result-meta"><span class="s-srch-result-date"><span class=metalabel>'+this.model.get("lang").srch_update+'</span> {{updated_formatted}}</span>{{# if (topics_text.length > 0) { }}<span class="divider">|</span><span class="s-srch-result-subj"><span class=metalabel>'+this.model.get("lang").srch_topic+'</span><ul class="list-inline metavalue" aria-label="'+this.model.get("lang").srch_topic+"\">{{# _.each(topics_text, function(v,k){ }}<li>{{v}}{{# if (k+1 < topics_text.length){ print(';'); } }}</li>{{# }); }}</ul></span>{{# } }}</div>",{silent:!0}):this.model.set("item_template",'<div class=s-srch-result-title><a href="{{url}}" data-faqid={{faqid}}>{{question}}</a></div><div class="s-srch-result-meta"><span class="s-srch-result-date"><span class=metalabel>'+this.model.get("lang").srch_update+'</span> {{updated_formatted}}</span>{{# if (topics_text.length > 0) { }}<span class="divider">|</span><span class="s-srch-result-subj"><span class=metalabel>'+this.model.get("lang").srch_topic+'</span><ul class="list-inline metavalue" aria-label="'+this.model.get("lang").srch_topic+'">{{# _.each(topics_text, function(v){ }}<li><span class="label label-default"><a href="#" data-topic="{{{v}}}">{{v}}</a></span></li>{{# }); }}</ul></span>{{# } }}</div>',{silent:!0})),""===this.item_template&&(this.item_template=_.template(this.model.get("item_template")));try{s=this.item_template(t)}catch(t){return searchcontroller.debug(t),""}return e.html(s)},gotoAnswer:function(t){var e=$(t.currentTarget).attr("data-faqid");if(e){if(void 0!==springSpace.querySpy)try{var s=this.model.get("query_typed");if(""==s||"*:*"==s)return;springSpace.querySpy.gotoFAQ({faqid:e})}catch(t){searchcontroller.debug(t)}}else searchcontroller.debug("no faqid");return!0},setFacet:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-topic");this.model.setFacet("topics",e)}}),LACurrentParamsView=CurrentParamsView.extend({render:function(){this.$el.html("");var t=jQuery("<div></div>").addClass("s-srch-params").attr({"aria-live":"polite","aria-relevant":"text"}),e=this.model.get("facets"),s=[];return _.each(e,function(t,e){if(t.length>0){if($li=$("<li></li>"),"g"==e){if(1==this.model.get("groups_available").length)return;if(!0===this.model.get("isDefaultGroup")&&compareArrays(this.model.get("group_id_default"),t))return $li.append("<span>"+this.model.get("lang").srch_filters_g+":</span> All"),void s.push($li)}$li.append("<span>"+this.model.get("lang")["srch_filters_"+e]+":</span> ");var i=" ";_.each(t,function(t,s,r){var a="g"==e?this.model.get("group_data")[t].name:t;i+='"'+a+'"',r.length>s+1&&(i+=" OR ")},this),t.length>1&&(i="("+i+")");var r=$("<span></span>").text(i);$li.append(r),s.push($li)}},this),s.length>0&&($li=$("<li></li>").append($('<a href="#" class="removeAll" aria-controls="s-srch-results-'+this.model.get("id")+'"></a>').html('<i class="fa fa-times-circle"></i> '+this.model.get("lang").srch_facetremoveall)),s.push($li)),s.length>0?(this.$list=$('<ul class="list-inline"></ul>'),_.each(s,function(t){this.$list.append(t)},this),t.append(["<h3>"+this.model.get("lang").srch_filtercurr+"</h3>",this.$list]),this.$el.append(t).removeClass("hidden")):this.$el.addClass("hidden"),this}}),LAFacetView=FacetView.extend({render:function(){switch(searchcontroller.debug("LAFacetView render"),searchcontroller.debug(this.facetType),this.facetType){case"g":this.makeLabel=function(t){return this.model.get("group_data")[t].name},this.facetSelected=function(t){return this.model.get("facets")[this.facetType].indexOf(t.toString())>-1};break;default:this.makeLabel=function(t){return t},this.facetSelected=function(t){return this.model.get("facets")[this.facetType].indexOf(t)>-1}}return this.header=this.model.get("lang")["srch_filters_"+this.facetType],this.$el.html(""),this.$el.append('<h3><button class="btn btn-default s-srch-facet-btn" type=button data-toggle="collapse" data-target="#s-srch-'+this.model.get("id")+"-cloud-"+this.facetType+'"><span class="s-srch-side-collapse"><i class="fa fa-caret-down"></i></span> '+this.header+"</button></h3>"),this.$list=$('<ul class="s-srch-cloud list-unstyled collapse in" id="s-srch-'+this.model.get("id")+"-cloud-"+this.facetType+'"></ul>'),this.$el.append(this.$list),this},makeList:function(){this.$list.empty();var t=this.model.get("facet_results"),e=(this.model.get("facets")[this.facetType],[]);"g"===this.facetType?_.each(this.model.get("groups_available"),function(s){var i=this.facetSelected(s),r=$("<li></li>"),a=$('<label class="check"></label>'),n=$('<input type="checkbox" />').attr("name",s).prop("checked",i).attr("aria-controls","s-srch-results-"+this.model.get("id")),o=_.find(t[this.facetType],function(t){return t.value==s}),l=o&&o.count?" ("+o.count+")":"";a.append([n," "+this.makeLabel(s)+l]),r.append(a),e.push(r)},this):t[this.facetType]&&t[this.facetType].length>0&&_.each(t[this.facetType],function(t){var s=this.facetSelected(t.value),i=$("<li></li>"),r=$('<label class="check"></label>'),a=$('<input type="checkbox" />').attr("name",t.value).prop("checked",s).attr("aria-controls","s-srch-results-"+this.model.get("id"));r.append(a).append(" "+this.makeLabel(t.value)+" ("+t.count+")"),i.append(r),e.push(i)},this),0==e.length?this.$list.append("<li>"+this.model.get("lang").srch_facetnone+"</li>"):_.each(e,function(t){this.$list.append(t)},this)}}),SearchLG=SearchInterface.extend({setConfig:function(t){var e={site_id:0,guide_id:0,group_data:[],display_facets:!0,facets:{group:[],tag:[],guide_type:[],subject:[]},sort:{field:"score",dir:"desc"},sort_options:[{field:"score",dir:"desc",label:this.get("lang").srch_sortlabelrel},{field:"updated",dir:"desc",label:this.get("lang").srch_sortlabeldatedesc}],query_facet_results:{},searchwt:{guide:6,page:5,subject:4,tag:4,allInOne:1},profile_url:""};_.extend(e,t),_.each(e,function(t,e,s){this.set(e,t,{silent:!0})},this),this.set("selector","#s-srch-source-"+this.get("id"),{silent:!0}),this.listenTo(searchcontroller,"facet:set",this.setLGFacet)},setLGFacet:function(t){t.facet&&""!==t.facet&&t.value&&""!==t.value&&this.get("facets")[t.facet]&&this.setFacet(t.facet,t.value,!1,!1)},renderViews:function(){var t=jQuery(this.get("selector")),e=[],s=new SearchHeader({model:this,id:"s-srch-header-"+this.get("id")});if("bento"!==searchcontroller.get("layout"))var i=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-top",location:"top"}),r={$el:""};else i={$el:""},r=new SearchFooter({model:this,id:"s-srch-footer-"+this.get("id")});var a=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-bottom",location:"bottom"}),n=new LGCurrentParamsView({model:this,id:"s-srch-params-"+this.get("id")}),o=new LGResultsList({model:this,id:"s-srch-results-"+this.get("id")});if(""!==this.get("description")&&e.push(jQuery('<div class="row"></div>').append(jQuery("<div>").addClass("col-sm-12 s-srch-description").attr("id","s-srch-description-"+this.get("id")).append(jQuery("<p>").html(this.get("description"))))),e.push(jQuery('<div class="row"></div>').append([s.$el,i.$el])),"bento"!==searchcontroller.get("layout")&&e.push(jQuery('<div class="row"></div>').append(n.$el)),e.push(jQuery('<div class="row"></div>').append(o.$el)),e.push(jQuery('<div class="row"></div>').append([r.$el,a.$el])),!0===this.get("display_facets")){var l=jQuery('<div class="col-md-9 col-left"></div>').append(e),c=jQuery('<div class="col-md-3 col-right"></div>'),u=[];_.each(this.get("facets"),function(t,e,s){u.push(new LGFacetView({model:this,id:"s-srch-facet-"+this.get("id")+"-"+e,facetType:e}))},this),_.each(u,function(t,e){c.append(t.$el)},this),t.append(jQuery('<div class="row"></div>').append(l,c))}else t.append(e)},buildQuery:function(t){void 0===t&&(t=!1),qo={search_source_id:this.get("id"),rows:this.get("perpage"),"facet.limit":20,"group.limit":4},facets=this.get("facets"),qo.fq=[],qo.fq.push("s:"+this.get("site_id"));var e=this.get("page");if(qo.start=qo.rows*(e-1),t)return qo.facet=!1,qo;_.each(facets,function(t,e,s){var i="";t.length>0&&(_.each(t,function(t,e,s){i+='"'+t+'"',e!==s.length-1&&(i+=" OR ")},this),qo.fq.push(e+":("+i+")"))},this),qo.q=this.convertSearch(),s=this.get("sort"),qo.sort=s.field+" "+s.dir,this.set("query_obj",qo)},convertSearch:function(){return this.get("query_typed")},requestData:function(){if("undefined"!=typeof searchLg2Local)searchLg2Local(this.get("id"));else{var t=this;workingAlert(),$.ajax({url:this.protocol+"//"+this.get("request_url"),data:this.get("query_obj"),success:function(s,i){clearTimeout(e),t.cacheResults(s),t.parseResults(s),t.setFocus(),stopAlert()},traditional:!0,dataType:"jsonp",jsonp:"json.wrf"});var e=setTimeout(function(){errorAlert()},1e4)}if(void 0!==springSpace.springTrack)try{if(facets.group&&facets.group.length>0?group_id=void 0!==this.get("group_data")[facets.group[0]]?this.get("group_data")[facets.group[0]].id:0:group_id=0,""==this.get("query_typed")||"*:*"==this.get("query_typed"))return;springSpace.springTrack.trackSearch({_st_type_id:"13",_st_group_id:group_id,_st_guide_id:this.get("guide_id"),_st_search_terms:this.get("query_typed")})}catch(t){searchcontroller.debug(t)}},retrieveFacets:function(){},parseFacets:function(t){"undefined"==typeof searchLg2Local&&(this.set("facet_results",t.facet_counts.facet_fields),this.trigger("facets:retrieve"))},parseResults:function(t){this.set("results",t.grouped.g.groups),this.set("total_results",t.grouped.g.ngroups),this.set("query_facet_results",t.facet_counts.facet_fields),0==t.grouped.g.ngroups?this.trigger("search:noresults"):this.trigger("search:retrieve"),this.get("display_facets")&&(this.facetCache[this.get("query_typed")]?this.parseFacets(this.facetCache[this.get("query_typed")]):(this.cacheFacets(this.get("query_typed"),t),this.parseFacets(t)))}}),LGResultsList=ResultsList.extend({events:{"click .s-srch-result-subj a":"setFacet"},render:function(){var t=$('<ul class="list-unstyled s-srch-results"></ul>'),e=this.model.get("results");return e.length>0&&_.each(e,function(e,s,i){t.append(this.resultItem(e))},this),this.$el.html(t),this},noResults:function(){return $(this.el).html(""),this},resultItem:function(t){var e=$("<li></li>").addClass("s-srch-result"),s="",i=t.doclist.docs,r=""==this.model.get("site_url")?"/":"//"+this.model.get("site_url"),a=t.doclist.docs[0];a.g||(a.g=""),a.guide||(a.guide=""),a.gd||(a.gd=""),a.aid||(a.aid="");var n="/"==r?r:r+"/";if(a.slug&&""!==a.slug?n+=a.slug:n+="c.php?g="+a.g,a.url=n,!a.updated_formatted){var o=new Date(a.updated);a.updated_formatted=o.format(this.model.get("lang").Dt_DateTime)}a.pages=[],_.each(i,function(t,e,s){var i="/"==r?r:r+"/";t.pslug&&""!==t.pslug?i+=t.pslug:t.slug&&""!==t.slug?i+=t.slug+"?p="+t.p:i+="c.php?g="+t.g+"&p="+t.p,a.pages.push({url:i,title:t.page})},this),a.profile_url=this.model.get("profile_url")+a.aid,a.an=a.an?a.an.replace(",",", "):"",void 0===a.subject&&(a.subject=[]),""===this.model.get("item_template")&&("bento"==searchcontroller.get("layout")?this.model.set("item_template",'<div class=s-srch-result-title><a href="{{url}}" data-guide_id={{g}}>{{guide}}</a></div>{{# if (gd !== "") { }}<p class=s-srch-result-desc">{{gd}}</p>{{# } }}<div class="s-srch-result-meta"><span class="s-srch-result-author"><span class=metalabel>'+this.model.get("lang").srch_by+'</span><a href="{{profile_url}}">{{an}}</a></span><span class="divider">|</span><span class="s-srch-result-date"><span class=metalabel>'+this.model.get("lang").srch_update+'</span> {{updated_formatted}}</span>{{# if (subject.length > 0) { }}<span class="divider">|</span><span class="s-srch-result-subj"><span class=metalabel>'+this.model.get("lang").srch_subject+'</span><ul class="list-inline metavalue" aria-label="'+this.model.get("lang").srch_subject+"\">{{# _.each(subject, function(v,k){ }}<li>{{v}}{{# if (k+1 < subject.length){ print(';'); } }}</li>{{# }); }}</ul></span>{{# } }}</div>",{silent:!0}):this.model.set("item_template",'<div class=s-srch-result-title><a href="{{url}}" data-guide_id={{g}}>{{guide}}</a></div>{{# if (gd !== "") { }}<p class=s-srch-result-desc">{{gd}}</p>{{# } }}<div class="s-srch-result-meta">{{# if (pages.length > 0) { }}<ul class="s-srch-result-pages">{{# _.each(pages, function(v){ }}<li><a href="{{v.url}}">{{v.title}}</a></li>{{# }); }}</ul>{{# } }}<span class="s-srch-result-author"><span class=metalabel>'+this.model.get("lang").srch_by+'</span><a href="{{profile_url}}">{{an}}</a></span><span class="divider">|</span><span class="s-srch-result-date"><span class=metalabel>'+this.model.get("lang").srch_update+'</span> {{updated_formatted}}</span>{{# if (subject.length > 0) { }}<span class="divider">|</span><span class="s-srch-result-subj"><span class=metalabel>'+this.model.get("lang").srch_subject+'</span><ul class="list-inline metavalue" aria-label="'+this.model.get("lang").srch_subject+'">{{# _.each(subject, function(v){ }}<li><span class="label label-default"><a href="#" data-subject="{{{v}}}">{{v}}</a></span></li>{{# }); }}</ul></span>{{# } }}</div>',{silent:!0})),""===this.item_template&&(this.item_template=_.template(this.model.get("item_template")));try{s=this.item_template(a)}catch(t){return searchcontroller.debug(t),""}return e.html(s)},gotoAnswer:function(t){return!0},setFacet:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-subject").toLowerCase();this.model.setFacet("subject",e)}}),LGCurrentParamsView=CurrentParamsView.extend({render:function(){this.$el.html("");var t=jQuery("<div></div>").addClass("s-srch-params").attr({"aria-live":"polite","aria-relevant":"text"}),e=this.model.get("facets"),s=[];return _.each(e,function(t,e){if(t.length>0){$li=jQuery("<li></li>"),$li.append("<span>"+this.model.get("lang")["srch_filters_"+e]+":</span> ");var i=" ";_.each(t,function(t,e,s){i+='"'+t+'"',s.length>e+1&&(i+=" OR ")},this),t.length>1&&(i="("+i+")");var r=$("<span></span>").text(i);$li.append(r),s.push($li)}},this),s.length>0&&($li=jQuery("<li></li>").append(jQuery('<a href="#" class="removeAll" aria-controls="s-srch-results-'+this.model.get("id")+'"></a>').html('<i class="fa fa-times-circle"></i> '+this.model.get("lang").srch_facetremoveall)),s.push($li)),s.length>0?(this.$list=$('<ul class="list-inline"></ul>'),_.each(s,function(t){this.$list.append(t)},this),t.append(["<h3>"+this.model.get("lang").srch_filtercurr+"</h3>",this.$list]),this.$el.append(t).removeClass("hidden")):this.$el.addClass("hidden"),this}}),LGFacetView=FacetView.extend({render:function(){switch(searchcontroller.debug("LGFacetView render"),searchcontroller.debug(this.facetType),this.facetType){case"group":this.makeLabel=function(t){return void 0!==this.model.get("group_data")[t]?this.model.get("group_data")[t].name:t},this.facetSelected=function(t){return this.model.get("facets")[this.facetType].indexOf(t)>-1};break;case"guide_type":case"subject":case"tag":this.makeLabel=function(t){return t.capitalize()},this.facetSelected=function(t){return this.model.get("facets")[this.facetType].indexOf(t)>-1}}return this.header=this.model.get("lang")["srch_filters_"+this.facetType],this.$el.html(""),this.$el.append('<h3><button class="btn btn-default s-srch-facet-btn" type=button data-toggle="collapse" data-target="#s-srch-'+this.model.get("id")+"-cloud-"+this.facetType+'"><span class="s-srch-side-collapse"><i class="fa fa-caret-down"></i></span> '+this.header+"</button></h3>"),this.$list=$('<ul class="s-srch-cloud list-unstyled collapse in" id="s-srch-'+this.model.get("id")+"-cloud-"+this.facetType+'"></ul>'),this.$el.append(this.$list),this},makeList:function(){this.$list.empty();var t=this.model.get("facet_results"),e=(this.model.get("facets")[this.facetType],[]);t&&_.each(t[this.facetType],function(t,s,i){var r=this.facetSelected(s),a=jQuery("<li></li>"),n=jQuery('<label class="check"></label>'),o=jQuery('<input type="checkbox" />').attr("name",s).prop("checked",r).attr("aria-controls","s-srch-results-"+this.model.get("id"));n.append(o).append(" "+this.makeLabel(s)+" ("+t+")"),a.append(n),e.push(a)},this),0==e.length?this.$list.append("<li>"+this.model.get("lang").srch_facetnone+"</li>"):_.each(e,function(t){this.$list.append(t)},this)}}),SearchAZ=SearchInterface.extend({setConfig:function(t){var e={site_id:0,display_facets:!0,facets:{subjects:[],types:[],vendor:[],_n:[]},perpage:50,sort:{field:"n",dir:"asc"},sort_options:[],query_facet_results:{},searchwt:{subjects:8,n:8,d:3,best_bets:9,allInOne:1},alphaLetter:""};_.extend(e,t),_.each(e,function(t,e,s){this.set(e,t,{silent:!0})},this),this.set("selector","#s-srch-source-"+this.get("id"),{silent:!0})},renderViews:function(){var t=jQuery(this.get("selector")),e=[],s=new AZCurrentParamsView({model:this,id:"s-srch-params-"+this.get("id")});if("bento"!==searchcontroller.get("layout"))var i=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-top",location:"top"}),r={$el:""};else i={$el:""},r=new SearchFooter({model:this,id:"s-srch-footer-"+this.get("id")});var a=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-bottom",location:"bottom"}),n=new AZResultsList({model:this,id:"s-srch-results-"+this.get("id")});if(""!==this.get("description")&&e.push(jQuery('<div class="row"></div>').append(jQuery("<div>").addClass("col-sm-12 s-srch-description").attr("id","s-srch-description-"+this.get("id")).append(jQuery("<p>").html(this.get("description"))))),e.push(jQuery('<div class="row"></div>').append(['<div class="col-sm-6"></div>',i.$el])),e.push(jQuery('<div class="row"></div>').append(s.$el)),e.push(jQuery('<div class="row"></div>').append(n.$el)),e.push(jQuery('<div class="row"></div>').append([r.$el,a.$el])),!0===this.get("display_facets"))if("undefined"!=typeof searchLg2Az){var o=jQuery('<div class="col-md-9 col-left"></div>').append(e),l=jQuery('<div class="col-md-3 col-right"></div>');t.append(jQuery('<div class="row"></div>').append([o,l]))}else{o=jQuery('<div class="col-md-12"></div>').append(e),l=jQuery('<div class="col-md-12"></div>');var c=[];_.each(this.get("facets"),function(t,e,s){"_n"==e?c.push(new AZBrowseView({model:this,facetType:e})):c.push(new AZFacetView({model:this,id:"s-srch-facet-"+this.get("id")+"-"+e,facetType:e}))},this),_.each(c,function(t,e){l.append(t.$el)},this),t.append(jQuery('<div class="row"></div>').append([l,o]))}else t.append(e)},buildQuery:function(t){void 0===t&&(t=!1),qo={search_source_id:this.get("id"),rows:this.get("perpage")};var e;e=this.get("facets"),qo["facet.limit"]=100,qo.fq=[],qo.fq.push("s:"+this.get("site_id"));var i=this.get("page");if(qo.start=qo.rows*(i-1),t)return qo.facet=!1,qo;_.each(e,function(t,e,s){var i="",r="";"_n"==e?t.length>0&&("#"==t[0]?qo.fq.push("-_n:/[a-z]/i"):qo.fq.push("_n:"+t[0])):t.length>0&&(_.each(t,function(t,e,s){r+='"'+t+'"',e!==s.length-1&&(r+=" OR ")},this),i=e+":("+r+")",qo.fq.push(i))},this),qo.q=this.convertSearch(),"*:*"==qo.q?this.set("sort",{field:"n",dir:"asc"}):this.set("sort",{field:"score",dir:"desc"}),s=this.get("sort"),qo.sort=s.field+" "+s.dir,this.set("query_obj",qo)},convertSearch:function(){return this.get("query_typed")},requestData:function(){if("undefined"!=typeof searchLg2Az)searchLg2Az(this.get("id"));else{var t=this;workingAlert(),$.ajax({url:this.protocol+"//"+this.get("request_url"),data:this.get("query_obj"),success:function(s,i){clearTimeout(e),t.cacheResults(s),t.parseResults(s),t.setFocus(),stopAlert()},traditional:!0,dataType:"jsonp",jsonp:"json.wrf"});var e=setTimeout(function(){errorAlert()},1e4)}if(void 0!==springSpace.springTrack)try{if(""==this.get("query_typed")||"*:*"==this.get("query_typed"))return;springSpace.springTrack.trackSearch({_st_type_id:"27",_st_group_id:0,_st_guide_id:0,_st_search_terms:this.get("query_typed")})}catch(t){searchcontroller.debug(t)}},parseFacets:function(t){if("undefined"==typeof searchLg2Az){if(searchcontroller.debug(this.get("id")+" parseFacets"),t.facet_counts.facet_fields&&t.facet_counts.facet_fields.best_bets){var e=t.facet_counts.facet_fields.best_bets;delete t.facet_counts.facet_fields.best_bets,t.facet_counts.facet_fields.subjects||(t.facet_counts.facet_fields.subjects={}),_.each(e,function(e,s){t.facet_counts.facet_fields.subjects[s]?t.facet_counts.facet_fields.subjects[s]=t.facet_counts.facet_fields.subjects[s]+e:t.facet_counts.facet_fields.subjects[s]=e},this)}if(t.facet_counts.facet_fields&&t.facet_counts.facet_fields._n){var s=t.facet_counts.facet_fields._n;t.facet_counts.facet_fields._n={},_.each(s,function(e,s){t.facet_counts.facet_fields._n[s]||(null==s.match(/[a-z]/i)&&(s="#"),t.facet_counts.facet_fields._n[s]=1)},this)}this.set("facet_results",t.facet_counts.facet_fields),this.trigger("facets:retrieve")}},parseResults:function(t){this.set({results:t.response.docs,total_results:t.response.numFound,query_facet_results:t.facet_counts.facet_fields}),this.get("display_facets")&&this.parseFacets(t),0==t.response.numFound?this.trigger("search:noresults"):this.trigger("search:retrieve")}}),AZResultsList=ResultsList.extend({events:{"click .s-srch-showqform":"showQForm","click .s-srch-result-subj a":"setFacet","click .s-srch-result-title a":"trackClick"},render:function(){var t=this.model.get("facets").subjects;this.cur_subj=t.length>0?t[0].toLowerCase():"";var e=$('<ul class="list-unstyled s-srch-results"></ul>'),s=$('<ul class="list-unstyled"></ul>'),i=this.model.get("results"),r=!1;return i.length>0&&_.each(i,function(t,i,a){var n=this.resultItem(t);n.hasClass("s-srch-result-featured")?(s.append(n),r=!0):e.append(n)},this),r&&e.prepend($("<li></li>").addClass("s-srch-results-featured").append([$("<h3></h3>").html(this.model.get("lang").az_bestbets_heading),s])),this.$el.html(e),this},noResults:function(){return $(this.el).html(""),this},resultItem:function(t){var e=$("<li></li>").addClass("s-srch-result");if(!t.id)return"";if(t.subjects=t.subjects?t.subjects:[],t.url=(""==this.model.get("site_url")?"/":"//"+this.model.get("site_url")+"/")+"go.php?c="+t.id,t.n||(t.n=""),t.d||(t.d=""),t.isbest=!1,""!==this.cur_subj&&t.best_bets&&t.best_bets.length>0&&Array.prototype.some){var s=-1;t.best_bets.some(function(t,e){if(this.cur_subj===t.toLowerCase())return s=e,!0},this),-1!==s&&(t.isbest=!0)}t.isbest&&e.addClass("s-srch-result-featured"),t.best_bets&&t.best_bets.length>0&&(t.subjects=_.union(t.best_bets,t.subjects)),t.isnew=t.new,""===this.model.get("item_template")&&("bento"==searchcontroller.get("layout")?this.model.set("item_template",'<div class=s-srch-result-title><a href="{{ url }}" data-id={{ id }}>{{ n }}</a>{{# if (isbest) { }} <span class="badge-featurd label label-success">'+this.model.get("lang").az_bestbets_label+'</span>{{# } }}{{# if (isnew) { }} <span class="badge-new label label-info">'+this.model.get("lang").az_new_label+'</span>{{# } }}{{# if (trial) { }} <span class="badge-trial label label-warning">'+this.model.get("lang").az_trial_label+'</span>{{# } }}</div><div class="s-srch-result-meta">{{# if (d !== \'\') { }}<p>{{ d }}</p>{{# } }}{{# if (subjects.length > 0) { }}<span class="s-srch-result-subj"><span class=metalabel>'+this.model.get("lang").srch_subject+'</span><ul class="list-inline metavalue" aria-label="'+this.model.get("lang").srch_subject+"\">{{# _.each(subjects, function(v,k){ }}<li>{{v}}{{# if (k+1 < subjects.length){ print(';'); } }}</li>{{# }); }}</ul></span>{{# } }}</div>",{silent:!0}):this.model.set("item_template",'<div class=s-srch-result-title><a href="{{ url }}" data-id={{ id }}>{{ n }}</a>{{# if (isbest) { }} <span class="badge-featurd label label-success">'+this.model.get("lang").az_bestbets_label+'</span>{{# } }}{{# if (isnew) { }} <span class="badge-new label label-info">'+this.model.get("lang").az_new_label+'</span>{{# } }}{{# if (trial) { }} <span class="badge-trial label label-warning">'+this.model.get("lang").az_trial_label+'</span>{{# } }}</div><div class="s-srch-result-meta">{{# if (d !== \'\') { }}<p>{{ d }}</p>{{# } }}{{# if (subjects.length > 0) { }}<span class="s-srch-result-subj"><span class=metalabel>'+this.model.get("lang").srch_subject+'</span><ul class="list-inline metavalue" aria-label="'+this.model.get("lang").srch_subject+'">{{# _.each(subjects, function(v){ }}<li><span class="label label-default"><a href="#" data-subject="{{{ v }}}">{{ v }}</a></span></li>{{# }); }}</ul></span>{{# } }}</div>',{silent:!0})),""===this.item_template&&(this.item_template=_.template(this.model.get("item_template")));try{html=this.item_template(t)}catch(t){return searchcontroller.debug(t),""}return e.html(html)},trackClick:function(t){if("undefined"!=typeof springTrack){var e=jQuery(t.currentTarget).attr("data-id");try{springTrack.trackLink({link:t.currentTarget,_st_type_id:"16",_st_content_id:e})}catch(t){searchcontroller.debug(t)}}return!0},setFacet:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-subject").toLowerCase();this.model.setFacet("subjects",e)}}),AZCurrentParamsView=CurrentParamsView.extend({render:function(){this.$el.html("");var t=jQuery("<div></div>").addClass("s-srch-params s-srch-params-az").attr({"aria-live":"polite","aria-relevant":"text"}),e=this.model.get("facets"),s=[];"bento"!==searchcontroller.get("layout")&&(_.each(e,function(t,e){if(t.length>0){$li=$("<li></li>");var i=" ";_.each(t,function(t,e,s){var r=t.capitalize();-1!==r.indexOf(" ")?i+='"'+r+'"':i+=r,s.length>e+1&&(i+=" OR ")},this),t.length>1&&(i="("+i+")"),i+=";";var r=$("<span></span>").text(i);$li.append(r),s.push($li)}},this),""!==this.model.get("query_typed")&&($li=$("<li></li>"),$li.append(" "+this.model.get("query_typed")+";"),s.push($li))),s.length>0&&($li=$("<li></li>").append($('<a href="#" class="removeAll" aria-controls="s-srch-results-'+this.model.get("id")+'"></a>').html('<i class="fa fa-times-circle"></i> '+this.model.get("lang").az_clear_filters)),s.push($li));var i=this.model.get("total_results"),r=this.model.get("perpage"),a=(this.model.get("page")-1)*r;return this.$rangeHeader=$("<span></span>").text(springSpace.Util.stringFormat(this.model.get("lang").srch_resrange,[Math.min(i,a+1)+" - "+Math.min(i,a+r),i])+" "+this.model.get("lang").az_database_plural),s.length>0?(this.$rangeHeader.text(this.$rangeHeader.text()+": "),this.$list=$('<ul class="list-inline"></ul>'),_.each(s,function(t){this.$list.append(t)},this),t.append([this.$rangeHeader,this.$list])):t.append(this.$rangeHeader),this.$el.append(t).removeClass("hidden"),this},removeAll:function(t){t.preventDefault(),this.model.removeAllFacets(!0)}}),AZFacetView=FacetView.extend({events:{"change select":"toggleFacet"},initialize:function(t){t.facetType&&(this.facetType=t.facetType),this.listenTo(this.model,"search:retrieve search:noresults",this.makeList),this.render()},render:function(){this.facetSelected=function(t){return this.model.get("facets")[this.facetType].indexOf(t)>-1},this.$el.html("");var t=jQuery("<label></label>").addClass("sr-only").attr("for","s-srch-"+this.model.get("id")+"-facet-"+this.facetType).html(this.model.get("lang")["az_dropdown_"+this.facetType]);this.$select=jQuery("<select></select>").attr({id:"s-srch-"+this.model.get("id")+"-facet-"+this.facetType,class:"form-control",name:this.facetType,"aria-controls":"s-srch-results-"+this.model.get("id")});var e=jQuery("<div></div>").addClass("col-sm-4 form-group").append([t,this.$select]);return this.$el.append(e),this},makeList:function(){this.$select.empty();var t=this.model.get("facet_results"),e=(this.model.get("facets")[this.facetType],[]);e.push($("<option></option>").text(this.model.get("lang")["srch_filters_az_"+this.facetType]).attr("value",""));var s=_.keys(t[this.facetType]).sort();_.each(s,function(t,s){var i=this.facetSelected(t)?"selected":"",r=$("<option></option>").text(t.capitalize()).attr("value",t).prop("selected",i);e.push(r)},this),0==e.length?this.$select.append("<option>"+this.model.get("lang").srch_facetnone+"</option>"):_.each(e,function(t){this.$select.append(t)},this)},toggleFacet:function(t){""==$(t.currentTarget).val()?this.model.removeFacet(this.facetType):this.model.setFacet(this.facetType,$(t.currentTarget).val(),!1)}}),AZBrowseView=Backbone.View.extend({events:{"click a[data-letter]":"browseAlpha"},initialize:function(t){t.facetType&&(this.facetType=t.facetType),this.render(),this.listenTo(this.model,"search:retrieve search:noresults",this.updateLetter),this.listenTo(this.model,"search:retrieve search:noresults",this.updateLinks)},render:function(){this.$el.html("");var t=jQuery("<h3></h3>").addClass("sr-only").attr("id","s-srch-"+this.model.get("id")+"-facet-"+this.facetType).html(this.model.get("lang").az_browse_name);this.$list=jQuery("<ol></ol>").attr({class:"list-unstyled list-inline","aria-labelledby":"s-srch-"+this.model.get("id")+"-facet-"+this.facetType});var e=[$("<li></li>").append($("<a></a>").html(this.model.get("lang").az_filter_all).attr({href:"#","data-letter":"","aria-controls":"s-srch-results-"+this.model.get("id")}))],s="abcdefghijklmnopqrstuvwxyz#".split("");_.each(s,function(t){e.push($("<li></li>").append($("<a></a>").html(t.toUpperCase()).attr({href:"#","data-letter":t,"aria-controls":"s-srch-results-"+this.model.get("id")})))},this),this.$list.append(e);var i=jQuery("<div></div>").addClass("col-sm-12 s-srch-alphabrowse").attr("id","s-srch-"+this.model.get("id")+"-alphabrowse").append([t,this.$list]);return this.$el.append(i),this},updateLetter:function(){var t=this.model.get("alphaLetter");this.$list.find("a").removeClass("current"),this.$list.find('a[data-letter="'+t+'"]').addClass("current")},updateLinks:function(){searchcontroller.debug("updateLinks");var t=this.model.get("facet_results")._n;this.$list.find("a").each(function(e,s){var i=$(s);i.removeClass("inactive");var r=i.attr("data-letter");""!==r&&t&&!t[r]&&i.addClass("inactive")})},browseAlpha:function(t){t.preventDefault();var e=$(t.currentTarget);if(!e.hasClass("inactive")){var s=e.attr("data-letter");""!=s?this.model.setFacet("_n",s,!1):this.model.removeFacet("_n")}}}),SearchBlog=SearchInterface.extend({setConfig:function(t){var e={site_id:0,guide_id:0,group_data:[],display_facets:!0,facets:{},sort:{field:"score",dir:"desc"},sort_options:[{field:"score",dir:"desc",label:this.get("lang").srch_sortlabelrel}],query_facet_results:{},searchwt:{allInOne:1},profile_url:"",debug:!0};_.extend(e,t),_.each(e,function(t,e,s){this.set(e,t,{silent:!0})},this),this.set("selector","#s-srch-source-"+this.get("id"),{silent:!0}),this.listenTo(searchcontroller,"facet:set",this.setBlogFacet)},setBlogFacet:function(t){t.facet&&""!==t.facet&&t.value&&""!==t.value&&this.get("facets")[t.facet]&&this.setFacet(t.facet,t.value,!1,!1)},renderViews:function(){var t=jQuery(this.get("selector")),e=[],s=new SearchHeader({model:this,id:"s-srch-header-"+this.get("id")});if("bento"!==searchcontroller.get("layout"))var i=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-top",location:"top"}),r={$el:""};else i={$el:""},r=new SearchFooter({model:this,id:"s-srch-footer-"+this.get("id")});var a=new PaginationView({model:this,id:"s-srch-paginate-"+this.get("id")+"-bottom",location:"bottom"}),n=new BlogCurrentParamsView({model:this,id:"s-srch-params-"+this.get("id")}),o=new BlogResultsList({model:this,id:"s-srch-results-"+this.get("id")});if(""!==this.get("description")&&e.push(jQuery('<div class="row"></div>').append(jQuery("<div>").addClass("col-sm-12 s-srch-description").attr("id","s-srch-description-"+this.get("id")).append(jQuery("<p>").html(this.get("description"))))),e.push(jQuery('<div class="row"></div>').append([s.$el,i.$el])),"bento"!==searchcontroller.get("layout")&&e.push(jQuery('<div class="row"></div>').append(n.$el)),e.push(jQuery('<div class="row"></div>').append(o.$el)),e.push(jQuery('<div class="row"></div>').append([r.$el,a.$el])),!0===this.get("display_facets")){var l=jQuery('<div class="col-md-9 col-left"></div>').append(e),c=jQuery('<div class="col-md-3 col-right"></div>'),u=[];_.each(this.get("facets"),function(t,e,s){u.push(new BlogFacetView({model:this,id:"s-srch-facet-"+this.get("id")+"-"+e,facetType:e}))},this),_.each(u,function(t,e){c.append(t.$el)},this),t.append(jQuery('<div class="row"></div>').append(l,c))}else t.append(e)},buildQuery:function(t){void 0===t&&(t=!1),qo={search_source_id:this.get("id"),rows:this.get("perpage"),"facet.limit":20,"group.limit":4},facets=this.get("facets"),qo.fq=[],qo.fq.push("s:"+this.get("site_id"));var e=this.get("page");if(qo.start=qo.rows*(e-1),t)return qo.facet=!1,qo;_.each(facets,function(t,e,s){var i="";t.length>0&&(_.each(t,function(t,e,s){i+='"'+t+'"',e!==s.length-1&&(i+=" OR ")},this),qo.fq.push(e+":("+i+")"))},this),qo.q=this.convertSearch(),s=this.get("sort"),qo.sort=s.field+" "+s.dir,this.set("query_obj",qo)},convertSearch:function(){return this.get("query_type")},requestData:function(){if("undefined"!=typeof searchBlogLocal)searchBlogLocal(this.get("id"));else{var t=this;workingAlert(),$.ajax({url:this.protocol+"//"+this.get("request_url"),data:this.get("query_obj"),success:function(s,i){clearTimeout(e),t.cacheResults(s),t.parseResults(s),t.setFocus(),stopAlert()},traditional:!0,dataType:"jsonp",jsonp:"json.wrf"});var e=setTimeout(function(){errorAlert()},1e4)}if(void 0!==springSpace.springTrack)try{if(facets.group&&facets.group.length>0?group_id=void 0!==this.get("group_data")[facets.group[0]]?this.get("group_data")[facets.group[0]].id:0:group_id=0,""==this.get("query_typed")||"*:*"==this.get("query_typed"))return;springSpace.springTrack.trackSearch({_st_type_id:"13",_st_group_id:group_id,_st_guide_id:this.get("guide_id"),_st_search_terms:this.get("query_typed")})}catch(t){searchcontroller.debug(t)}},retrieveFacets:function(){},parseFacets:function(t){"undefined"==typeof searchBlogLocal&&(this.set("facet_results",t.facet_counts.facet_fields),this.trigger("facets:retrieve"))},parseResults:function(t){this.set("results",t.grouped.g.groups),this.set("total_results",t.grouped.g.ngroups),this.set("query_facet_results",t.facet_counts.facet_fields),0==t.grouped.g.ngroups?this.trigger("search:noresults"):this.trigger("search:retrieve"),this.get("display_facets")&&(this.facetCache[this.get("query_typed")]?this.parseFacets(this.facetCache[this.get("query_typed")]):(this.cacheFacets(this.get("query_typed"),t),this.parseFacets(t)))}}),BlogResultsList=ResultsList.extend({events:{"click .s-srch-result-subj a":"setFacet"},render:function(){var t=$('<ul class="list-unstyled s-srch-results"></ul>'),e=this.model.get("results");return e.length>0&&_.each(e,function(e,s,i){t.append(this.resultItem(e))},this),this.$el.html(t),this},noResults:function(){return $(this.el).html(""),this},resultItem:function(t){var e=$("<li></li>").addClass("s-srch-result"),s="",i=t.doclist.docs,r=""==this.model.get("site_url")?"/":"//"+this.model.get("site_url"),a=t.doclist.docs[0];a.g||(a.g=""),a.guide||(a.guide=""),a.gd||(a.gd=""),a.aid||(a.aid="");var n="/"==r?r:r+"/";if(a.slug&&""!==a.slug?n+=a.slug:n+="c.php?g="+a.g,a.url=n,!a.updated_formatted){var o=new Date(a.updated);a.updated_formatted=o.format(this.model.get("lang").Dt_DateTime)}a.pages=[],_.each(i,function(t,e,s){var i="/"==r?r:r+"/";t.pslug&&""!==t.pslug?i+=t.pslug:t.slug&&""!==t.slug?i+=t.slug+"?p="+t.p:i+="c.php?g="+t.g+"&p="+t.p,a.pages.push({url:i,title:t.page})},this),a.profile_url=this.model.get("profile_url")+a.aid,a.an=a.an?a.an.replace(",",", "):"",void 0===a.subject&&(a.subject=[]),""===this.item_template&&(this.item_template=_.template(this.model.get("item_template")));try{s=this.item_template(a)}catch(t){return searchcontroller.debug(t),""}return e.html(s)},gotoAnswer:function(t){return!0},setFacet:function(t){t.preventDefault();var e=$(t.currentTarget).attr("data-subject").toLowerCase();this.model.setFacet("subject",e)}}),BlogCurrentParamsView=CurrentParamsView.extend({render:function(){this.$el.html("");var t=jQuery("<div></div>").addClass("s-srch-params").attr({"aria-live":"polite","aria-relevant":"text"}),e=this.model.get("facets"),s=[];return _.each(e,function(t,e){if(t.length>0){$li=jQuery("<li></li>"),$li.append("<span>"+this.model.get("lang")["srch_filters_"+e]+":</span> ");var i=" ";_.each(t,function(t,e,s){i+='"'+t+'"',s.length>e+1&&(i+=" OR ")},this),t.length>1&&(i="("+i+")");var r=$("<span></span>").text(i);$li.append(r),s.push($li)}},this),s.length>0&&($li=jQuery("<li></li>").append(jQuery('<a href="#" class="removeAll" aria-controls="s-srch-results-'+this.model.get("id")+'"></a>').html('<i class="fa fa-times-circle"></i> '+this.model.get("lang").srch_facetremoveall)),s.push($li)),s.length>0?(this.$list=$('<ul class="list-inline"></ul>'),_.each(s,function(t){this.$list.append(t)},this),t.append(["<h3>"+this.model.get("lang").srch_filtercurr+"</h3>",this.$list]),this.$el.append(t).removeClass("hidden")):this.$el.addClass("hidden"),this}}),BlogFacetView=FacetView.extend({render:function(){return searchcontroller.debug("BlogFacetView render"),searchcontroller.debug(this.facetType),this.header=this.model.get("lang")["srch_filters_"+this.facetType],this.$el.html(""),this.$el.append('<h3><button class="btn btn-default s-srch-facet-btn" type=button data-toggle="collapse" data-target="#s-srch-'+this.model.get("id")+"-cloud-"+this.facetType+'"><span class="s-srch-side-collapse"><i class="fa fa-caret-down"></i></span> '+this.header+"</button></h3>"),this.$list=$('<ul class="s-srch-cloud list-unstyled collapse in" id="s-srch-'+this.model.get("id")+"-cloud-"+this.facetType+'"></ul>'),this.$el.append(this.$list),this},makeList:function(){this.$list.empty();var t=this.model.get("facet_results"),e=(this.model.get("facets")[this.facetType],[]);t&&_.each(t[this.facetType],function(t,s,i){var r=this.facetSelected(s),a=jQuery("<li></li>"),n=jQuery('<label class="check"></label>'),o=jQuery('<input type="checkbox" />').attr("name",s).prop("checked",r).attr("aria-controls","s-srch-results-"+this.model.get("id"));n.append(o).append(" "+this.makeLabel(s)+" ("+t+")"),a.append(n),e.push(a)},this),0==e.length?this.$list.append("<li>"+this.model.get("lang").srch_facetnone+"</li>"):_.each(e,function(t){this.$list.append(t)},this)}});"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(t){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(t){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var s,i,r,a,n,o=gap,l=e[t];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(t)),"function"==typeof rep&&(l=rep.call(e,t,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,n=[],"[object Array]"===Object.prototype.toString.apply(l)){for(a=l.length,s=0;s<a;s+=1)n[s]=str(s,l)||"null";return r=0===n.length?"[]":gap?"[\n"+gap+n.join(",\n"+gap)+"\n"+o+"]":"["+n.join(",")+"]",gap=o,r}if(rep&&"object"==typeof rep)for(a=rep.length,s=0;s<a;s+=1)"string"==typeof rep[s]&&(r=str(i=rep[s],l))&&n.push(quote(i)+(gap?": ":":")+r);else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(r=str(i,l))&&n.push(quote(i)+(gap?": ":":")+r);return r=0===n.length?"{}":gap?"{\n"+gap+n.join(",\n"+gap)+"\n"+o+"}":"{"+n.join(",")+"}",gap=o,r}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,s){var i;if(gap="",indent="","number"==typeof s)for(i=0;i<s;i+=1)indent+=" ";else"string"==typeof s&&(indent=s);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(t,e){var s,i,r=t[e];if(r&&"object"==typeof r)for(s in r)Object.prototype.hasOwnProperty.call(r,s)&&(void 0!==(i=walk(r,s))?r[s]=i:delete r[s]);return reviver.call(t,e,r)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(t,e){"use strict";var s=t.History=t.History||{},i=t.jQuery;if(void 0!==s.Adapter)throw new Error("History.js Adapter has already been loaded...");s.Adapter={bind:function(t,e,s){i(t).bind(e,s)},trigger:function(t,e,s){i(t).trigger(e,s)},extractEventData:function(t,e,s){return e&&e.originalEvent&&e.originalEvent[t]||s&&s[t]||void 0},onDomLoad:function(t){i(t)}},void 0!==s.init&&s.init()}(window),function(t,e){"use strict";var s=t.document,i=t.setTimeout||i,r=t.clearTimeout||r,a=t.setInterval||a,n=t.History=t.History||{};if(void 0!==n.initHtml4)throw new Error("History.js HTML4 Support has already been loaded...");n.initHtml4=function(){if(void 0!==n.initHtml4.initialized)return!1;n.initHtml4.initialized=!0,n.enabled=!0,n.savedHashes=[],n.isLastHash=function(t){return t===n.getHashByIndex()},n.isHashEqual=function(t,e){return(t=encodeURIComponent(t).replace(/%25/g,"%"))===(e=encodeURIComponent(e).replace(/%25/g,"%"))},n.saveHash=function(t){return!n.isLastHash(t)&&(n.savedHashes.push(t),!0)},n.getHashByIndex=function(t){return void 0===t?n.savedHashes[n.savedHashes.length-1]:t<0?n.savedHashes[n.savedHashes.length+t]:n.savedHashes[t]},n.discardedHashes={},n.discardedStates={},n.discardState=function(t,e,s){var i,r=n.getHashByState(t);return i={discardedState:t,backState:s,forwardState:e},n.discardedStates[r]=i,!0},n.discardHash=function(t,e,s){var i={discardedHash:t,backState:s,forwardState:e};return n.discardedHashes[t]=i,!0},n.discardedState=function(t){var e=n.getHashByState(t);return n.discardedStates[e]||!1},n.discardedHash=function(t){return n.discardedHashes[t]||!1},n.recycleState=function(t){var e=n.getHashByState(t);return n.discardedState(t)&&delete n.discardedStates[e],!0},n.emulated.hashChange&&(n.hashChangeInit=function(){n.checkerFunction=null;var e,i,r,o,l="",c=Boolean(n.getHash());return n.isInternetExplorer()?(e="historyjs-iframe",(i=s.createElement("iframe")).setAttribute("id",e),i.setAttribute("src","#"),i.style.display="none",s.body.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.close(),r="",o=!1,n.checkerFunction=function(){if(o)return!1;o=!0;var e=n.getHash(),s=n.getHash(i.contentWindow.document);return e!==l?(l=e,s!==e&&(r=s=e,i.contentWindow.document.open(),i.contentWindow.document.close(),i.contentWindow.document.location.hash=n.escapeHash(e)),n.Adapter.trigger(t,"hashchange")):s!==r&&(r=s,c&&""===s?n.back():n.setHash(s,!1)),o=!1,!0}):n.checkerFunction=function(){var e=n.getHash()||"";return e!==l&&(l=e,n.Adapter.trigger(t,"hashchange")),!0},n.intervalList.push(a(n.checkerFunction,n.options.hashChangeInterval)),!0},n.Adapter.onDomLoad(n.hashChangeInit)),n.emulated.pushState&&(n.onHashChange=function(e){var s,i,r=e&&e.newURL||n.getLocationHref(),a=n.getHashByUrl(r);return n.isLastHash(a)?(n.busy(!1),!1):(n.doubleCheckComplete(),n.saveHash(a),a&&n.isTraditionalAnchor(a)?(n.Adapter.trigger(t,"anchorchange"),n.busy(!1),!1):(s=n.extractState(n.getFullUrl(a||n.getLocationHref()),!0),n.isLastSavedState(s)?(n.busy(!1),!1):(n.getHashByState(s),(i=n.discardedState(s))?(n.getHashByIndex(-2)===n.getHashByState(i.forwardState)?n.back(!1):n.forward(!1),!1):(n.pushState(s.data,s.title,encodeURI(s.url),!1),!0))))},n.Adapter.bind(t,"hashchange",n.onHashChange),n.pushState=function(e,s,i,r){if(i=encodeURI(i).replace(/%25/g,"%"),n.getHashByUrl(i))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(!1!==r&&n.busy())return n.pushQueue({scope:n,callback:n.pushState,args:arguments,queue:r}),!1;n.busy(!0);var a=n.createStateObject(e,s,i),o=n.getHashByState(a),l=n.getState(!1),c=n.getHashByState(l),u=n.getHash(),h=n.expectedStateId==a.id;return n.storeState(a),n.expectedStateId=a.id,n.recycleState(a),n.setTitle(a),o===c?(n.busy(!1),!1):(n.saveState(a),h||n.Adapter.trigger(t,"statechange"),n.isHashEqual(o,u)||n.isHashEqual(o,n.getShortUrl(n.getLocationHref()))||n.setHash(o,!1),n.busy(!1),!0)},n.replaceState=function(e,s,i,r){if(i=encodeURI(i).replace(/%25/g,"%"),n.getHashByUrl(i))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(!1!==r&&n.busy())return n.pushQueue({scope:n,callback:n.replaceState,args:arguments,queue:r}),!1;n.busy(!0);var a=n.createStateObject(e,s,i),o=n.getHashByState(a),l=n.getState(!1),c=n.getHashByState(l),u=n.getStateByIndex(-2);return n.discardState(l,a,u),o===c?(n.storeState(a),n.expectedStateId=a.id,n.recycleState(a),n.setTitle(a),n.saveState(a),n.Adapter.trigger(t,"statechange"),n.busy(!1)):n.pushState(a.data,a.title,a.url,!1),!0}),n.emulated.pushState&&n.getHash()&&!n.emulated.hashChange&&n.Adapter.onDomLoad(function(){n.Adapter.trigger(t,"hashchange")})},void 0!==n.init&&n.init()}(window),function(t,e){"use strict";var s=t.console||void 0,i=t.document,r=t.navigator,a=!1,n=t.setTimeout,o=t.clearTimeout,l=t.setInterval,c=t.clearInterval,u=t.JSON,h=t.alert,d=t.History=t.History||{},p=t.history;try{(a=t.sessionStorage).setItem("TEST","1"),a.removeItem("TEST")}catch(t){a=!1}if(u.stringify=u.stringify||u.encode,u.parse=u.parse||u.decode,void 0!==d.init)throw new Error("History.js Core has already been loaded...");d.init=function(t){return void 0!==d.Adapter&&(void 0!==d.initCore&&d.initCore(),void 0!==d.initHtml4&&d.initHtml4(),!0)},d.initCore=function(e){if(void 0!==d.initCore.initialized)return!1;if(d.initCore.initialized=!0,d.options=d.options||{},d.options.hashChangeInterval=d.options.hashChangeInterval||100,d.options.safariPollInterval=d.options.safariPollInterval||500,d.options.doubleCheckInterval=d.options.doubleCheckInterval||500,d.options.disableSuid=d.options.disableSuid||!1,d.options.storeInterval=d.options.storeInterval||1e3,d.options.busyDelay=d.options.busyDelay||250,d.options.debug=d.options.debug||!1,d.options.initialTitle=d.options.initialTitle||i.title,d.options.html4Mode=d.options.html4Mode||!1,d.options.delayInit=d.options.delayInit||!1,d.intervalList=[],d.clearAllIntervals=function(){var t,e=d.intervalList;if(void 0!==e&&null!==e){for(t=0;t<e.length;t++)c(e[t]);d.intervalList=null}},d.debug=function(){d.options.debug&&d.log.apply(d,arguments)},d.log=function(){var t,e,r,a,n,o=!(void 0===s||void 0===s.log||void 0===s.log.apply),l=i.getElementById("log");for(o?(t=(a=Array.prototype.slice.call(arguments)).shift(),void 0!==s.debug?s.debug.apply(s,[t,a]):s.log.apply(s,[t,a])):t="\n"+arguments[0]+"\n",e=1,r=arguments.length;e<r;++e){if("object"==typeof(n=arguments[e])&&void 0!==u)try{n=u.stringify(n)}catch(t){}t+="\n"+n+"\n"}return l?(l.value+=t+"\n-----\n",l.scrollTop=l.scrollHeight-l.clientHeight):o||h(t),!0},d.getInternetExplorerMajorVersion=function(){return d.getInternetExplorerMajorVersion.cached=void 0!==d.getInternetExplorerMajorVersion.cached?d.getInternetExplorerMajorVersion.cached:function(){for(var t=3,e=i.createElement("div"),s=e.getElementsByTagName("i");(e.innerHTML="\x3c!--[if gt IE "+ ++t+"]><i></i><![endif]--\x3e")&&s[0];);return t>4&&t}()},d.isInternetExplorer=function(){return d.isInternetExplorer.cached=void 0!==d.isInternetExplorer.cached?d.isInternetExplorer.cached:Boolean(d.getInternetExplorerMajorVersion())},d.options.html4Mode?d.emulated={pushState:!0,hashChange:!0}:d.emulated={pushState:!Boolean(t.history&&t.history.pushState&&t.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(r.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(r.userAgent))),hashChange:Boolean(!("onhashchange"in t||"onhashchange"in i)||d.isInternetExplorer()&&d.getInternetExplorerMajorVersion()<8)},d.enabled=!d.emulated.pushState,d.bugs={setHash:Boolean(!d.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),safariPoll:Boolean(!d.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),ieDoubleCheck:Boolean(d.isInternetExplorer()&&d.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(d.isInternetExplorer()&&d.getInternetExplorerMajorVersion()<7)},d.isEmptyObject=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},d.cloneObject=function(t){var e,s;return t?(e=u.stringify(t),s=u.parse(e)):s={},s},d.getRootUrl=function(){var t=i.location.protocol+"//"+(i.location.hostname||i.location.host);return i.location.port&&(t+=":"+i.location.port),t+="/"},d.getBaseHref=function(){var t=i.getElementsByTagName("base"),e="";return 1===t.length&&(e=t[0].href.replace(/[^\/]+$/,"")),(e=e.replace(/\/+$/,""))&&(e+="/"),e},d.getBaseUrl=function(){return d.getBaseHref()||d.getBasePageUrl()||d.getRootUrl()},d.getPageUrl=function(){return((d.getState(!1,!1)||{}).url||d.getLocationHref()).replace(/\/+$/,"").replace(/[^\/]+$/,function(t,e,s){return/\./.test(t)?t:t+"/"})},d.getBasePageUrl=function(){return d.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(t,e,s){return/[^\/]$/.test(t)?"":t}).replace(/\/+$/,"")+"/"},d.getFullUrl=function(t,e){var s=t,i=t.substring(0,1);return e=void 0===e||e,/[a-z]+\:\/\//.test(t)||(s="/"===i?d.getRootUrl()+t.replace(/^\/+/,""):"#"===i?d.getPageUrl().replace(/#.*/,"")+t:"?"===i?d.getPageUrl().replace(/[\?#].*/,"")+t:e?d.getBaseUrl()+t.replace(/^(\.\/)+/,""):d.getBasePageUrl()+t.replace(/^(\.\/)+/,"")),s.replace(/\#$/,"")},d.getShortUrl=function(t){var e=t,s=d.getBaseUrl(),i=d.getRootUrl();return d.emulated.pushState&&(e=e.replace(s,"")),e=e.replace(i,"/"),d.isTraditionalAnchor(e)&&(e="./"+e),e=e.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},d.getLocationHref=function(t){return(t=t||i).URL===t.location.href?t.location.href:t.location.href===decodeURIComponent(t.URL)?t.URL:t.location.hash&&decodeURIComponent(t.location.href.replace(/^[^#]+/,""))===t.location.hash?t.location.href:-1==t.URL.indexOf("#")&&-1!=t.location.href.indexOf("#")?t.location.href:t.URL||t.location.href},d.store={},d.idToState=d.idToState||{},d.stateToId=d.stateToId||{},d.urlToId=d.urlToId||{},d.storedStates=d.storedStates||[],d.savedStates=d.savedStates||[],d.normalizeStore=function(){d.store.idToState=d.store.idToState||{},d.store.urlToId=d.store.urlToId||{},d.store.stateToId=d.store.stateToId||{}},d.getState=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0);var s=d.getLastSavedState();return!s&&e&&(s=d.createStateObject()),t&&((s=d.cloneObject(s)).url=s.cleanUrl||s.url),s},d.getIdByState=function(t){var e,s=d.extractId(t.url);if(!s)if(e=d.getStateString(t),void 0!==d.stateToId[e])s=d.stateToId[e];else if(void 0!==d.store.stateToId[e])s=d.store.stateToId[e];else{for(;s=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),void 0!==d.idToState[s]||void 0!==d.store.idToState[s];);d.stateToId[e]=s,d.idToState[s]=t}return s},d.normalizeState=function(t){var e,s;return t&&"object"==typeof t||(t={}),void 0!==t.normalized?t:(t.data&&"object"==typeof t.data||(t.data={}),(e={}).normalized=!0,e.title=t.title||"",e.url=d.getFullUrl(t.url?t.url:d.getLocationHref()),e.hash=d.getShortUrl(e.url),e.data=d.cloneObject(t.data),e.id=d.getIdByState(e),e.cleanUrl=e.url.replace(/\??\&_suid.*/,""),e.url=e.cleanUrl,s=!d.isEmptyObject(e.data),(e.title||s)&&!0!==d.options.disableSuid&&(e.hash=d.getShortUrl(e.url).replace(/\??\&_suid.*/,""),/\?/.test(e.hash)||(e.hash+="?"),e.hash+="&_suid="+e.id),e.hashedUrl=d.getFullUrl(e.hash),(d.emulated.pushState||d.bugs.safariPoll)&&d.hasUrlDuplicate(e)&&(e.url=e.hashedUrl),e)},d.createStateObject=function(t,e,s){var i={data:t,title:e,url:s};return i=d.normalizeState(i)},d.getStateById=function(t){return t=String(t),d.idToState[t]||d.store.idToState[t]||void 0},d.getStateString=function(t){var e;return e={data:d.normalizeState(t).data,title:t.title,url:t.url},u.stringify(e)},d.getStateId=function(t){return d.normalizeState(t).id},d.getHashByState=function(t){return d.normalizeState(t).hash},d.extractId=function(t){var e,s;return s=-1!=t.indexOf("#")?t.split("#")[0]:t,(e=/(.*)\&_suid=([0-9]+)$/.exec(s))&&e[1]||t,(e?String(e[2]||""):"")||!1},d.isTraditionalAnchor=function(t){return!/[\/\?\.]/.test(t)},d.extractState=function(t,e){var s,i,r=null;return e=e||!1,(s=d.extractId(t))&&(r=d.getStateById(s)),r||(i=d.getFullUrl(t),(s=d.getIdByUrl(i)||!1)&&(r=d.getStateById(s)),r||!e||d.isTraditionalAnchor(t)||(r=d.createStateObject(null,null,i))),r},d.getIdByUrl=function(t){return d.urlToId[t]||d.store.urlToId[t]||void 0},d.getLastSavedState=function(){return d.savedStates[d.savedStates.length-1]||void 0},d.getLastStoredState=function(){return d.storedStates[d.storedStates.length-1]||void 0},d.hasUrlDuplicate=function(t){var e;return(e=d.extractState(t.url))&&e.id!==t.id},d.storeState=function(t){return d.urlToId[t.url]=t.id,d.storedStates.push(d.cloneObject(t)),t},d.isLastSavedState=function(t){var e=!1;return d.savedStates.length&&(e=t.id===d.getLastSavedState().id),e},d.saveState=function(t){return!d.isLastSavedState(t)&&(d.savedStates.push(d.cloneObject(t)),!0)},d.getStateByIndex=function(t){return void 0===t?d.savedStates[d.savedStates.length-1]:t<0?d.savedStates[d.savedStates.length+t]:d.savedStates[t]},d.getCurrentIndex=function(){return d.savedStates.length<1?0:d.savedStates.length-1},d.getHash=function(t){var e=d.getLocationHref(t);return d.getHashByUrl(e)},d.unescapeHash=function(t){var e=d.normalizeHash(t);return e=decodeURIComponent(e)},d.normalizeHash=function(t){return t.replace(/[^#]*#/,"").replace(/#.*/,"")},d.setHash=function(t,e){var s,r;return!1!==e&&d.busy()?(d.pushQueue({scope:d,callback:d.setHash,args:arguments,queue:e}),!1):(d.busy(!0),(s=d.extractState(t,!0))&&!d.emulated.pushState?d.pushState(s.data,s.title,s.url,!1):d.getHash()!==t&&(d.bugs.setHash?(r=d.getPageUrl(),d.pushState(null,null,r+"#"+t,!1)):i.location.hash=t),d)},d.escapeHash=function(e){var s=d.normalizeHash(e);return s=t.encodeURIComponent(s),d.bugs.hashEscape||(s=s.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),s},d.getHashByUrl=function(t){var e=String(t).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return e=d.unescapeHash(e)},d.setTitle=function(t){var e,s=t.title;s||(e=d.getStateByIndex(0))&&e.url===t.url&&(s=e.title||d.options.initialTitle);try{i.getElementsByTagName("title")[0].innerHTML=s.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(t){}return i.title=s,d},d.queues=[],d.busy=function(t){if(void 0!==t?d.busy.flag=t:void 0===d.busy.flag&&(d.busy.flag=!1),!d.busy.flag){o(d.busy.timeout);var e=function(){var t,s,i;if(!d.busy.flag)for(t=d.queues.length-1;t>=0;--t)0!==(s=d.queues[t]).length&&(i=s.shift(),d.fireQueueItem(i),d.busy.timeout=n(e,d.options.busyDelay))};d.busy.timeout=n(e,d.options.busyDelay)}return d.busy.flag},d.busy.flag=!1,d.fireQueueItem=function(t){return t.callback.apply(t.scope||d,t.args||[])},d.pushQueue=function(t){return d.queues[t.queue||0]=d.queues[t.queue||0]||[],d.queues[t.queue||0].push(t),d},d.queue=function(t,e){return"function"==typeof t&&(t={callback:t}),void 0!==e&&(t.queue=e),d.busy()?d.pushQueue(t):d.fireQueueItem(t),d},d.clearQueue=function(){return d.busy.flag=!1,d.queues=[],d},d.stateChanged=!1,d.doubleChecker=!1,d.doubleCheckComplete=function(){return d.stateChanged=!0,d.doubleCheckClear(),d},d.doubleCheckClear=function(){return d.doubleChecker&&(o(d.doubleChecker),d.doubleChecker=!1),d},d.doubleCheck=function(t){return d.stateChanged=!1,d.doubleCheckClear(),d.bugs.ieDoubleCheck&&(d.doubleChecker=n(function(){return d.doubleCheckClear(),d.stateChanged||t(),!0},d.options.doubleCheckInterval)),d},d.safariStatePoll=function(){var e=d.extractState(d.getLocationHref());if(!d.isLastSavedState(e))return e||d.createStateObject(),d.Adapter.trigger(t,"popstate"),d},d.back=function(t){return!1!==t&&d.busy()?(d.pushQueue({scope:d,callback:d.back,args:arguments,queue:t}),!1):(d.busy(!0),d.doubleCheck(function(){d.back(!1)}),p.go(-1),!0)},d.forward=function(t){return!1!==t&&d.busy()?(d.pushQueue({scope:d,callback:d.forward,args:arguments,queue:t}),!1):(d.busy(!0),d.doubleCheck(function(){d.forward(!1)}),p.go(1),!0)},d.go=function(t,e){var s;if(t>0)for(s=1;s<=t;++s)d.forward(e);else{if(!(t<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(s=-1;s>=t;--s)d.back(e)}return d},d.emulated.pushState){var f=function(){};d.pushState=d.pushState||f,d.replaceState=d.replaceState||f}else d.onPopState=function(e,s){var i,r,a,n=!1;return d.doubleCheckComplete(),(r=d.getHash())?((a=d.extractState(r||d.getLocationHref(),!0))?d.replaceState(a.data,a.title,a.url,!1):(d.Adapter.trigger(t,"anchorchange"),d.busy(!1)),d.expectedStateId=!1,!1):((n=(i=d.Adapter.extractEventData("state",e,s)||!1)?d.getStateById(i):d.expectedStateId?d.getStateById(d.expectedStateId):d.extractState(d.getLocationHref()))||(n=d.createStateObject(null,null,d.getLocationHref())),d.expectedStateId=!1,d.isLastSavedState(n)?(d.busy(!1),!1):(d.storeState(n),d.saveState(n),d.setTitle(n),d.Adapter.trigger(t,"statechange"),d.busy(!1),!0))},d.Adapter.bind(t,"popstate",d.onPopState),d.pushState=function(e,s,i,r){if(d.getHashByUrl(i)&&d.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==r&&d.busy())return d.pushQueue({scope:d,callback:d.pushState,args:arguments,queue:r}),!1;d.busy(!0);var a=d.createStateObject(e,s,i);return d.isLastSavedState(a)?d.busy(!1):(d.storeState(a),d.expectedStateId=a.id,p.pushState(a.id,a.title,a.url),d.Adapter.trigger(t,"popstate")),!0},d.replaceState=function(e,s,i,r){if(d.getHashByUrl(i)&&d.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(!1!==r&&d.busy())return d.pushQueue({scope:d,callback:d.replaceState,args:arguments,queue:r}),!1;d.busy(!0);var a=d.createStateObject(e,s,i);return d.isLastSavedState(a)?d.busy(!1):(d.storeState(a),d.expectedStateId=a.id,p.replaceState(a.id,a.title,a.url),d.Adapter.trigger(t,"popstate")),!0};if(a){try{d.store=u.parse(a.getItem("History.store"))||{}}catch(t){d.store={}}d.normalizeStore()}else d.store={},d.normalizeStore();d.Adapter.bind(t,"unload",d.clearAllIntervals),d.saveState(d.storeState(d.extractState(d.getLocationHref(),!0))),a&&(d.onUnload=function(){var t,e,s;try{t=u.parse(a.getItem("History.store"))||{}}catch(e){t={}}for(e in t.idToState=t.idToState||{},t.urlToId=t.urlToId||{},t.stateToId=t.stateToId||{},d.idToState)d.idToState.hasOwnProperty(e)&&(t.idToState[e]=d.idToState[e]);for(e in d.urlToId)d.urlToId.hasOwnProperty(e)&&(t.urlToId[e]=d.urlToId[e]);for(e in d.stateToId)d.stateToId.hasOwnProperty(e)&&(t.stateToId[e]=d.stateToId[e]);d.store=t,d.normalizeStore(),s=u.stringify(t);try{a.setItem("History.store",s)}catch(t){if(t.code!==DOMException.QUOTA_EXCEEDED_ERR)throw t;a.length&&(a.removeItem("History.store"),a.setItem("History.store",s))}},d.intervalList.push(l(d.onUnload,d.options.storeInterval)),d.Adapter.bind(t,"beforeunload",d.onUnload),d.Adapter.bind(t,"unload",d.onUnload)),d.emulated.pushState||(d.bugs.safariPoll&&d.intervalList.push(l(d.safariStatePoll,d.options.safariPollInterval)),"Apple Computer, Inc."!==r.vendor&&"Mozilla"!==(r.appCodeName||"")||(d.Adapter.bind(t,"hashchange",function(){d.Adapter.trigger(t,"popstate")}),d.getHash()&&d.Adapter.onDomLoad(function(){d.Adapter.trigger(t,"hashchange")})))},d.options&&d.options.delayInit||d.init()}(window);